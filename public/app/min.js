var app=angular.module("dbonyx",["AuctionCtrls","ItemCtrls","MenuCtrls","UserCtrls","ngRoute","ngCookies","ngAnimate"]);app.config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,r){r.interceptors.push("AuthInterceptor"),e.when("/",{templateUrl:"app/views/index.html"}).when("/about",{templateUrl:"app/views/about.html"}).when("/auctions",{templateUrl:"app/views/auctions.html"}).when("/auctions/:realm",{templateUrl:"app/views/auctions.html"}).when("/database",{templateUrl:"app/views/database.html"}).when("/character",{templateUrl:"app/views/character/lookup.html"}).when("/c/:name/:server/",{templateUrl:"app/views/character/profile.html"}).when("/c/:name/:server/reputation",{templateUrl:"app/views/character/reputation.html"}).when("/c/:name/:server/achievements",{templateUrl:"app/views/character/achievements.html"}).when("/c/:name/:server/mounts",{templateUrl:"app/views/character/mounts.html"}).when("/c/:name/:server/battlepets",{templateUrl:"app/views/character/battlepets.html"}).when("/c/:name/:server/professions",{templateUrl:"app/views/character/professions.html"}).when("/c/:name/:server/pvp",{templateUrl:"app/views/character/pvp.html"}).when("/g/:name/:server",{controller:"guildCtrl",templateUrl:"app/views/guild/profile.html"}).when("/community",{templateUrl:"app/views/community.html"}).when("/feedback",{templateUrl:"app/views/feedback.html"}).when("/item/:id",{templateUrl:"app/views/item.html"}).when("/mount/:id",{templateUrl:"app/views/mount.html"}).when("/privacy",{templateUrl:"app/views/privacy.html"}).when("/profile",{controller:"privateProfileCtrl",templateUrl:"app/views/privateprofile.html"}).when("/profile/:username",{controller:"publicProfileCtrl",templateUrl:"app/views/publicprofile.html"}).when("/quests",{controller:"allQuestsCtrl",templateUrl:"app/views/quests.html"}).when("/quests/:questId",{controller:"questCtrl",templateUrl:"app/views/quest.html"}).when("/register",{templateUrl:"app/views/register.html"}).when("/terms",{templateUrl:"app/views/terms.html"}).when("/validate/:user/:validateString",{templateUrl:"app/views/validate.html"}).when("/forums",{controller:"forumCtrl",templateUrl:"app/views/forums/forumMain.html"}).when("/forums/cat/:categoryId",{controller:"forumCatCtrl",templateUrl:"app/views/forums/forumCategory.html"}).when("/forums/thread/:threadId",{controller:"forumThreadCtrl",templateUrl:"app/views/forums/forumThread.html"}).when("/forums/admin",{controller:"forumAdminCtrl",templateUrl:"app/views/forums/forumAdmin.html"}).when("/battlepets",{controller:"allpetsCtrl",templateUrl:"app/views/battlepets/allpets.html"}).when("/battlepet",{controller:"allpetsCtrl",templateUrl:"app/views/battlepets/allpets.html"}).when("/battlepet/:id",{controller:"battlepetCtrl",templateUrl:"app/views/battlepets/battlepet.html"}).when("/parsertest",{controller:"parserCtrl",templateUrl:"app/views/parsertest.html"}).otherwise({templateUrl:"app/views/404.html"}),t.html5Mode(!0)}]).factory("onyxPersistence",["$cookies",function(e){var t,r={},n={};return r.setRealm=function(r){t=r,e.put("realm",r)},r.getRealm=function(){return t||e.get("realm")||""},r.set=function(t,r){n[t]=r,e.put(t,r)},r.get=function(t){return n[t]||e.get(t)||""},r}]).controller("mountCtrl",["$scope","$routeParams","$http",function(e,t,r){e.mountId=parseInt(t.id),e.mount={},e.loading=!0,e.mountId&&r({method:"GET",url:"/api/mount/"+e.mountId}).then(function(t){e.mount=t.data.mount},function(e){})}]).controller("feedbackCtrl",["$http","$scope",function(e,t){t.showForm=!0,t.sendFeedback=function(){t.error="",t.message&&t.title?e({url:"/api/user/feedback",method:"POST",data:{title:t.title,message:t.message}}).then(function(e){t.success="Your message has been sent successfully!",t.showForm=!1},function(e){t.error="There was an error sending your message, please try again."}):t.error="Please provide a title and a message."}}]).controller("watchlistCtrl",["$scope","$http",function(e,t){var r=function(){t({method:"GET",url:"/api/watchlist/"}).then(function(t){e.watchlists=t.data.watchlists},function(e){})};r(),e.watchlists=[]}]),angular.module("dbonyx").controller("searchBarCtrl",["$scope","searchBar",function(e,t){e.search=function(){t.search(e.searchTerm,function(t,r){return t?void(e.results=[]):void(e.results=r)})},e.clear=function(){e.searchTerm="",e.results=[]},e.hide=function(){setTimeout(function(){e.results=[],e.$apply()},100)},e.clear()}]).factory("searchBar",["$http",function(e){var t={};return t.results={},t.search=function(t,r){if(t.length<3)return r(!1,[]);var n={url:"/api/item/search/"+t};e(n).then(function(e){r(!1,e.data)},function(e){r(e.data.error)})},t}]),angular.module("UserCtrls",[]).factory("onyxUser",["$http","Auth",function(e,t){var r={loggedin:!1};return r.checkLoggedInStatus=function(){r.loggedin=t.isLoggedIn(),r.loggedin&&e({method:"POST",url:"/api/user/getUser"}).then(function(e){r.username=e.data.username,r.loggedin=!0},function(e){})},r.validateUser=function(t,r,n){e({method:"POST",url:"/api/user/validate",data:{username:t,validateString:r}}).then(function(e){return e},function(e){return n("There was an error validating your email.")})},r.login=function(n,o,i){e({method:"POST",url:"/api/user/login",data:{email:n,password:o}}).then(function(e){t.saveToken(e.data.token),r.username=e.data.username,r.email=e.data.email,r.loggedin=!0,i(null,!0)},function(e){i(e.data.error,!1)})},r.logout=function(){t.removeToken(),r.loggedin=!1,r.username=null,r.email=null},r.register=function(t,n,o,i,a){e({method:"POST",url:"/api/user/register",data:{username:t,email:n,password1:o,password2:i}}).then(function(e){r.login(n,o,function(e,t){a(!0)})},function(e){return a(null,e.data.error)})},r.getPublicProfile=function(t,r){e({url:"/api/user/publicProfile",params:{username:t}}).then(function(e){return r(null,e.data)},function(e){return r(e.data.error)})},r.getPrivateProfile=function(t){e({url:"/api/user/privateProfile"}).then(function(e){return t(null,e.data)},function(e){return t(e.data.error)})},r.checkLoggedInStatus(),r}]).factory("Auth",["$window",function(e){return{saveToken:function(t){e.localStorage["onyx-token"]=t},getToken:function(){return e.localStorage["onyx-token"]},removeToken:function(){return e.localStorage.removeItem("onyx-token")},isLoggedIn:function(){var e=this.getToken();return!!e}}}]).factory("AuthInterceptor",["Auth",function(e){return{request:function(t){var r=e.getToken();return r&&(t.headers.Authorization="JWT "+r),t}}}]).controller("validateCtrl",["$http","$location","$scope","$routeParams","onyxUser",function(e,t,r,n,o){o.validateUser(n.user,n.validateString,function(e){r.error=e})}]).controller("userCtrl",["onyxUser","$scope","$http","$location","$window",function(e,t,r,n,o){t.user=e,t.showRegisterForm=!1,t.showUserPanel=!1,t.showRegisterForm=!1,t.toggleRegister=function(){t.showRegisterForm=!t.showRegisterForm,t.signin=!1},t.login=function(){t.signin=!1,e.login(t.login.email,t.login.password,function(e,r){t.login.email=null,t.login.password=null,e&&(t.error=e),t.showRegisterForm=!1})},t.logout=function(){e.logout(),t.user=e,t.showUserPanel=!1},t.toggleUserPanel=function(){t.showUserPanel=!t.showUserPanel},t.signinActive=function(){t.signin=!0,t.showRegisterForm=!1,t.narrow=o.innerWidth<750,document.getElementById("email").focus()},t.register=function(){e.register(t.username,t.email,t.password1,t.password2,function(e,r){e?(t.success="Registered Successfully!",t.toggleRegister()):r&&(t.registerError=r)})},t.clearError=function(){t.error=!1,t.registerError=!1,t.success=!1}}]).directive("userRegisterForm",[function(){return{restrict:"E",replace:!0,templateUrl:"app/templates/userRegisterForm.html"}}]).directive("userPanel",[function(){return{restrict:"E",replace:!0,templateUrl:"app/templates/userPanel.html"}}]),angular.module("AuctionCtrls",[]).controller("AuctionCtrl",["$scope","$http","$location","$routeParams","onyxPersistence","auctionService","realmService",function(e,t,r,n,o,i,a){var l=r.search();e.auctionService=i,e.searchTerm=l.s||"",e.realmInput=n.realm||"",e.validFilters=[{name:"Item Level",type:"Number"},{name:"Required Level",type:"Number"},{name:"Is Equippable",type:"Boolean"}],e.itemQualities=["Poor","Common","Uncommon","Rare","Epic","Legendary","Artifact","Heirloom"],e.selectedQuality="",e.auctionResults=i.auctionResults,e.loading=!1,e.filters=i.filters,e.newfilter={},e.validComparators=null,e.qualities={values:[]},e.auctionSettings=i.settings;var s=function(e){for(var t,r,n=e.length;0!==n;)r=Math.floor(Math.random()*n),n--,t=e[n],e[n]=e[r],e[r]=t;return e};a.getRealms(function(){e.realms=s(a.realms)}),e.setSortBy=function(t){i.setSortBy(t),e.search()},e.updateFilter=function(){"Number"===e.validFilters[e.newfilter.type].type?(e.validComparators=[">","=","<"],e.showFilterValue=!0):"Boolean"===e.validFilters[e.newfilter.type].type&&(e.validComparators=["True","False"],e.showFilterValue=!1)},e.addFilter=function(){var t=e.validFilters[e.newfilter.type].name,r=e.newfilter.comparator,n=e.newfilter.value;i.filters.push({type:t,comparator:r,value:n}),e.newfilter={},e.showFilterValue=!1,e.validComparators=null,e.search()},e.removeFilter=function(t){i.filters.splice(t,1),e.search()};var u=function(t){e.loading=!1,e.auctionResults=i.auctionResults,e.$broadcast("paginateUpdate")};e.search=function(t){t&&t.preventDefault(),e.loading=!0,i.qualities=e.qualities.values.map(function(e,t){return e?t.toString():null}).filter(function(e){return e}),i.filters=e.filters,i.setSearchTerm(e.searchTerm),i.setRealm(e.realmInput),i.search(u)},e.realmInput&&e.search()}]),angular.module("AuctionCtrls").directive("auctionResult",function(){var e=["$scope",function(e){e.toggleHistory=function(){e.showAuctionHistory=!e.showAuctionHistory}}];return{restrict:"E",replace:!0,controller:e,templateUrl:"app/templates/auctionResult.html"}}).directive("watchlistForm",function(){var e=["$scope","$http","onyxUser",function(e,t,r){e.user=r,e.minQuantity=1,e.item?e.maxQuantity=e.item.stackable||9999:e.maxQuantity=9999,e.price||(e.price=0),e.originalPrice=e.price,e.gold=Math.floor(e.price/1e4),e.silver=Math.floor(e.price%1e4/100),e.copper=e.price%100,e.submit=function(){var r=parseInt(e.copper+100*e.silver+1e4*e.gold);t({method:"POST",url:"/api/watchlist",data:{price:r,item:e.item._id,min:e.minQuantity,max:e.maxQuantity,realm:e.realmInput}}).then(function(e){},function(e){})}}];return{restrict:"E",controller:e,scope:{item:"=",price:"@",showWatchlist:"=",realmInput:"="},templateUrl:"app/templates/watchlist.html"}}).directive("auctionHistory",function(){var e=["$scope","auctionHistory",function(e,t){e.item&&t.search(e.item._id,e.realmInput,function(t,r){if(e.aucHistoryLoading=!1,t||!r)return t;e.histories=r.histories,e.count=e.histories.length,e.barwidth=Math.floor(480/e.count),e.barheight=280,e.width=e.barwidth*e.count;for(var n=0;n<e.histories.length;n++){var o=parseInt(e.histories[n].sellingPrice/e.histories[n].sold);e.histories[n].x=e.barwidth*n,e.histories[n].y=e.barheight-(e.barheight-25)*o/r.max,e.histories[n].averagePrice=o,e.histories[n].soldy=e.barheight+(40-40*(e.histories[n].sold/r.maxQuantity)),e.histories[n].soldheight=40*(e.histories[n].sold/r.maxQuantity),e.histories[n].expiredheight=40*(e.histories[n].expired/r.maxQuantity),e.histories[n].expiredy=e.histories[n].soldy-e.histories[n].expiredheight}}),e.aucHistoryLoading=!0,e.hoverIn=function(t){e.histories[t].selected=!0,e.selected=e.histories[t]},e.hoverOut=function(t){e.histories[t].selected=!1,e.selected=!1}}];return{restrict:"E",controller:e,scope:{item:"=",showAuctionHistory:"&",realmInput:"="},templateUrl:"app/templates/auctionHistory.html"}}),angular.module("AuctionCtrls").factory("auctionService",["$http",function(e){var t={searchTerm:"",realmInput:"",filters:[],qualities:[],sortBy:"buyout",sortOrder:-1,loading:!1,settings:{limit:25,offset:0},auctionResults:!1};return t.setSearchTerm=function(e){t.searchTerm=e},t.setRealm=function(e){t.realmInput=e},t.noMatch=function(){t.loading=!1,t.auctionResults=[],t.settings.count=0},t.search=function(r){return t.realmInput.length?void e({method:"GET",url:"/api/auction/fetchauctions",params:{"qualities[]":t.qualities,"filters[]":t.filters,searchTerm:t.searchTerm,realm:t.realmInput,offset:t.settings.offset,limit:t.settings.limit,sortBy:t.sortBy,sortOrder:t.sortOrder}}).then(function(e){t.loading=!1,t.auctionResults=e.data,t.settings.count=e.data.count,r(!0)},function(e){t.noMatch(),r(!1)}):(t.noMatch(),void r(!1))},t.setSortBy=function(e){t.sortBy===e?t.sortOrder*=-1:(t.sortBy=e,t.sortOrder=-1)},t}]).factory("auctionHistory",["$http",function(e){var t={};return t.search=function(t,r,n){e({method:"GET",url:"/api/auction/auctionHistory",params:{item:t,realm:r}}).then(function(e){n(null,e.data)},function(e){n(e.data,null)})},t}]),angular.module("dbonyx").controller("battlepetCtrl",["$scope","$routeParams","$location","battlepetService",function(e,t,r,n){e.id=t.id,e.petFamilies=n.petFamilies;var o=r.search();e.applyChanges=function(){e.pet.breedId||(e.pet.breedId=parseInt(o.b)||3),e.pet.level||(e.pet.level=parseInt(o.l)||1),e.pet.quality||(e.pet.quality=parseInt(o.q)||e.pet.qualityId||0)},e.computeStats=function(){e.pet.computed||(e.pet.computed={});var t=1+e.pet.quality/10,r=n.breeds[e.pet.breedId]||n.breeds[0],o=e.pet.level;e.pet.computed.health=Math.round(100+(e.pet.stats.health+10*r.h)*o*t),e.pet.computed.power=Math.round((e.pet.stats.power+2*r.p)*o*t),e.pet.computed.speed=Math.round((e.pet.stats.speed+2*r.s)*o*t)},e.getPet=function(){e.loading=!0,n.getOne(e.id,{},function(t,r){return e.loading=!1,t?e.error=t:(e.pet=r,e.applyChanges(),void e.computeStats())})},e.getPet()}]).controller("allpetsCtrl",["$scope","$location","battlepetService",function(e,t,r){var n=t.search();e.settings=r.settings,e.petFamilies=r.petFamilies,e.settings.offset=parseInt(n.o)||e.settings.offset||0,e.settings.limit=parseInt(n.l)||e.settings.limit||25,e.filters={families:[]},e.loading=!0,e.search=function(){r.filters=e.filters,r.getAll(e.offset,e.limit,function(t,r){return e.$broadcast("paginateUpdate"),e.loading=!1,t?e.error=t:void(e.pets=r)})},e.search()}]).factory("battlepetService",["$http",function(e){var t={};return t.settings={limit:25,offset:0,count:0},t.petFamilies=["Humanoid","Dragonkin","Flying","Undead","Critter","Magical","Elemental","Beast","Aquatic","Mechanical"],t.breeds={0:{h:0,p:0,s:0,n:"Unknown Breed"},3:{h:.25,p:.25,s:.25,n:"B/B"},4:{h:0,p:1,s:0,n:"P/P"},5:{h:0,p:0,s:1,n:"S/S"},6:{h:1,p:0,s:0,n:"H/H"},7:{h:.45,p:.45,s:0,n:"H/P"},8:{h:0,p:.45,s:.45,n:"P/S"},9:{h:.45,p:0,s:.45,n:"H/S"},10:{h:.2,p:.45,s:.2,n:"P/B"},11:{h:.2,p:.2,s:.45,n:"S/B"},12:{h:.45,p:.2,s:.2,n:"H/B"}},t.filters={},t.getAll=function(r,n,o){e({method:"GET",url:"/api/battlepet/",params:{offset:t.settings.offset,limit:t.settings.limit,filters:t.filters}}).then(function(e){t.settings.count=e.data.count,o(null,e.data.pets)},function(e){t.settings.count=e.data.count,o(e.error)})},t.getOne=function(t,r,n){t=parseInt(t),r=r||{},e({url:"/api/battlepet/"+t,params:{modifiers:r}}).then(function(e){n(null,e.data)},function(e){n(e.error)})},t}]),angular.module("dbonyx").controller("characterCtrl",["onyxPersistence","onyxCharacter","$scope","$http","$location",function(e,t,r,n,o){r.character=t,r.search=function(e){r.error=!1,e&&e.preventDefault();var t=r.characterName,n=r.realmInput;return t&&n?void r.character.search(t,n,function(e){if(e){var t=e.name,n=e.realm,i=e.region;o.url("/c/"+t+"/"+n+"-"+i+"/")}else r.error="Unable to find character."}):void(r.error="Missing one or more required fields.")},r.selectCharacter=function(e){var n=r.results[e].name,i=r.results[e].realm,a=r.results[e].region.toUpperCase();t.setCharacter(r.results[e]),o.url("/c/"+n+"/"+i+"-"+a+"/")}}]).controller("characterMain",["onyxCharacter","$routeParams","$scope",function(e,t,r){var n=t.name,o=t.server;e.name&&e.name==t.name||e.search(n,o,function(e){e&&(r.character=e,console.log("loaded"))}),r.character=e,r.character.get("items"),r.character.get("mounts"),r.character.get("achievements"),r.character.get("reputation"),r.character.get("battlepets")}]).controller("characterProfessions",["onyxCharacter","$routeParams","$scope",function(e,t,r){var n=t.name,o=t.server;e.name&&e.name==t.name||e.search(n,o,function(e){e&&(r.character=e,console.log("loaded"))}),r.character=e,r.character.get("professions"),r.expandRecipes=[!1,!1,!1,!1,!1,!1],r.expandToggle=function(e){r.expandRecipes[e]=!r.expandRecipes[e]}}]),angular.module("dbonyx").directive("characterLinks",[function(){var e=["$scope",function(e){e.links=[{title:"Profile",suffix:""},{title:"Reputation",suffix:"reputation"},{title:"Achievements",suffix:"achievements"},{title:"Mounts",suffix:"mounts"},{title:"Battlepets",suffix:"battlepets"},{title:"Professions",suffix:"professions"},{title:"Pvp",suffix:"pvp"}]}];return{controller:e,restrict:"E",replace:!0,templateUrl:"app/templates/characterLinks.html"}}]),angular.module("dbonyx").factory("onyxCharacter",["$http",function(e){var t={},r=[],n={items:!0,mounts:!0,achievements:!0,reputation:!0,professions:!0,battlepets:!0};return t.loaded=!1,t.setCharacter=function(e){for(var r in e)t[r]=e[r]},t.runOnLoad=function(){for(var e=0;e<r.length;e++)t.get(r[e])},t.search=function(r,n,o){if(t.loading=!0,!r)return t.loading=!1,void o(!1);var i={name:r};n&&(i.realm=n),e({method:"GET",url:"/api/character/search",params:i}).then(function(e){1===e.data.count?(t.setCharacter(e.data.character),t.loading=!1,t.loaded=!0,t.runOnLoad(),o(t)):(t.loading=!1,o(e.data.characters))},function(e){t.loading=!1,o(!1)})},t.get=function(o){if(n[o]){if(!t.loaded)return void r.push(o);if(t.name&&t.realm&&t.region){var i={name:t.name,realm:t.realm,region:t.region};e({method:"GET",url:"/api/character/"+o,params:i}).then(function(e){console.log(o),t[o]=e.data[o],"professions"===o&&console.log(e.data)},function(e){console.log(e)})}}},t}]),angular.module("dbonyx").controller("importCtrl",["$scope","fileUpload",function(e,t){e.setFile=function(t){e.selectedFile=t},e.importData=function(){e.selectedFile&&(console.log("importing"),t.uploadFileToUrl(e.selectedFile[0]))}}]).service("fileUpload",["$http","Auth",function(e,t){this.uploadFileToUrl=function(t){var r=new FormData;r.append("importFile",t),e.post("/api/data/import",r,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){}).error(function(){})}}]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,r,n){var o=e(n.fileModel),i=o.assign;r.bind("change",function(){t.$apply(function(){i(t,r[0].files[0])})})}}}]),angular.module("oi.select",[]),angular.module("oi.select").provider("oiSelect",function(){return{options:{debounce:500,searchFilter:"oiSelectCloseIcon",dropdownFilter:"oiSelectHighlight",listFilter:"oiSelectAscSort",groupFilter:"oiSelectGroup",editItem:!1,newItem:!1,closeList:!0,saveTrigger:"enter tab blur"},version:{full:"0.2.20",major:0,minor:2,dot:20},$get:function(){return{options:this.options,version:this.version}}}}).factory("oiSelectEscape",function(){var e=/[-\/\\^$*+?.()|[\]{}]/g,t="\\$&";return function(r){return String(r).replace(e,t)}}).factory("oiSelectEditItem",function(){return function(e,t,r,n){return n?"":r(e)}}).factory("oiUtils",["$document","$timeout",function(e,t){function r(e,t,r){for(var n=t;n&&n.ownerDocument&&11!==n.nodeType;){if(r){if(n===e)return!1;if(n.className.indexOf(r)>=0)return!0}else if(n===e)return!0;n=n.parentNode}return!1}function n(n,o){function i(e){return e&&"INPUT"!==e.target.nodeName?void 0:(p=!1,c?void(p=!0):void t(function(){n.triggerHandler("blur")}))}function a(){u||(u=!0,t(function(){n.triggerHandler("focus")}))}function l(){c=!0}function s(e){c=!1;var a=e.target,l=r(n[0],a);p&&!l&&i(),l&&"INPUT"!==a.nodeName&&t(function(){o[0].focus()}),!l&&u&&(u=!1)}var u,c,p;return e[0].addEventListener("click",s,!0),n[0].addEventListener("mousedown",l,!0),n[0].addEventListener("blur",i,!0),o.on("focus",a),function(){e[0].removeEventListener("click",s),n[0].removeEventListener("mousedown",l,!0),n[0].removeEventListener("blur",i,!0),o.off("focus",a)}}function o(e,t){var r,n,o,i,l,u;t&&(n=e.offsetHeight,o=s(t,"height","margin"),i=e.scrollTop||0,r=a(t).top-a(e).top+i,l=r,u=r-n+o,r+o>n+i?e.scrollTop=u:i>r&&(e.scrollTop=l))}function i(e,t,r,n,o){function i(e){return parseFloat(o[e])}for(var a=r===(n?"border":"content")?4:"width"===t?1:0,l=0,s=["Top","Right","Bottom","Left"];4>a;a+=2)"margin"===r&&(l+=i(r+s[a])),n?("content"===r&&(l-=i("padding"+s[a])),"margin"!==r&&(l-=i("border"+s[a]+"Width"))):(l+=i("padding"+s[a]),"padding"!==r&&(l+=i("border"+s[a]+"Width")));return l}function a(e){var t,r,n=e.getBoundingClientRect(),o=e&&e.ownerDocument;if(o)return t=o.documentElement,r=l(o),{top:n.top+r.pageYOffset-t.clientTop,left:n.left+r.pageXOffset-t.clientLeft}}function l(e){return null!=e&&e===e.window?e:9===e.nodeType&&e.defaultView}function s(e,t,r){var n=!0,o="width"===t?e.offsetWidth:e.offsetHeight,a=window.getComputedStyle(e,null),l=!1;if(0>=o||null==o){if(o=a[t],(0>o||null==o)&&(o=e.style[t]),f.test(o))return o;o=parseFloat(o)||0}return o+i(e,t,r||(l?"border":"content"),n,a)}function u(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t].length)return!1;return!0}function c(e){var t=[];return angular.forEach(e,function(e,r){"$"!==r.toString().charAt(0)&&t.push(e)}),t}function p(e,t,r,n,o){var i,a,l,s,u,c=o?[].concat(e):[];for(i=0,l=e.length;i<e.length;i++)for(s=r?r(e[i]):e[i],a=0;a<t.length;a++)if(u=n?n(t[a]):t[a],angular.equals(s,u,e,t,i,a)){o?c.splice(i+c.length-l,1):c.push(t[a]);break}return c}function d(e,t,r,n){var o={};return e.split(".").reduce(function(e,r,n,o){return e[r]=n<o.length-1?{}:t},o),n(r,o)}var m=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,f=new RegExp("^("+m+")(?!px)[a-z%]+$","i");return{contains:r,bindFocusBlur:n,scrollActiveOption:o,groupsIsEmpty:u,objToArr:c,getValue:d,intersection:p}}]),angular.module("oi.select").directive("oiSelect",["$document","$q","$timeout","$parse","$interpolate","$injector","$filter","$animate","oiUtils","oiSelect",function(e,t,r,n,o,i,a,l,s,u){var c=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,p=/([^\(\)\s\|\s]*)\s*(\(.*\))?\s*(\|?\s*.+)?/;return{restrict:"AE",templateUrl:"src/template.html",require:"ngModel",scope:{},compile:function(e,d){var m=d.oiOptions,f=m?m.match(c):["","i","","","","i","","",""];if(!f)throw new Error("Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_'");var g,h,v,w,y,$,b,P,I=/ as /.test(f[0])&&f[1],C=f[2]||f[1],S=f[5]||f[7],x=f[3]||"",U=f[4]||"",T=f[9]||C,k=f[8].match(p),q=k[1],F=q+(k[3]||""),E=q+(k[2]||""),A=I&&n(I),L=n(C),O=n(x),R=n(U),H=n(F),M=n(E),D=n(T),Q=o(d.multiplePlaceholder||""),B=o(d.placeholder||""),V=n(d.oiSelectOptions),N=angular.version.major<=1&&angular.version.minor<=3;return function(e,o,c,p){function d(){ue&&o.removeClass("cleanMode"),ue=!1}function m(e,t){t=t||150,o.addClass(e),r(function(){o.removeClass(e)},t)}function I(){e.listItemHide=!0,e.inputHide=!1}function C(){var t=z(p.$modelValue);e.listItemHide=!t,e.inputHide=t}function x(t){s.contains(o[0],t.target,"disabled")||e.output.length>=b&&s.contains(o[0],t.target,"select-dropdown")||(e.inputHide&&e.removeItem(0),!e.isOpen||!le.closeList||"INPUT"===t.target.nodeName&&e.query.length?J(e.query):(Z({query:le.editItem&&!ue}),e.$evalAsync()))}function U(t){e.isFocused||(e.isFocused=!0,c.disabled||(e.backspaceFocus=!1))}function T(t){e.isFocused=!1,$||C(),k("blur")||Z(),e.$evalAsync()}function k(n,o){o||(o=n,n=e.query);var i,a=le.saveTrigger.split(" ").indexOf(o)+1,l=le.newItem&&n,s="blur"!==o?e.order[e.selectorPosition]:null;return a&&(l||s)?(e.showLoader=!0,i=t.when(s||P(e.$parent,{$query:n})),i.then(function(n){if(void 0===n)return t.reject();e.addItem(n);var o=e.order.length-1;e.selectorPosition===o&&ee(ne,0),le.newItemFn&&!s||r(angular.noop),Z()})["catch"](function(){m("invalid-item"),e.showLoader=!1}),!0):void 0}function F(){var e=$&&z(p.$modelValue)?ie:oe;re.attr("placeholder",e)}function E(t){return s.getValue(S,t,e.$parent,D)}function _(t){return s.getValue(S,t,e.$parent,A)}function G(t){return s.getValue(S,t,e.$parent,L)}function W(t){return s.getValue(S,t,e.$parent,R)}function j(t){return s.getValue(S,t,e.$parent,O)||""}function Y(t){return s.getValue(q,t,e.$parent,H)}function X(e){return e=e instanceof Array?e:e?[e]:[],e.filter(function(e){return e&&(e instanceof Array&&e.length||A||G(e))})}function z(e){return!!X(e).length}function J(n,i){return v&&ce&&r.cancel(v),v=r(function(){var a=M(e.$parent,{$query:n,$selectedAs:i})||"";return e.selectorPosition="prompt"===le.newItem?!1:0,n||i||(e.oldQuery=null),(a.$promise&&!a.$resolved||angular.isFunction(a.then))&&(ce=le.debounce),e.showLoader=!0,t.when(a.$promise||a).then(function(t){if(e.groups={},t&&!i){var r=$?e.output:[],a=ve(s.objToArr(t),n,G,we(e.$parent),o),l=s.intersection(a,r,E,E,!0),u=Y(l);e.groups=te(u)}return K(),t})["finally"](function(){e.showLoader=!1,le.closeList&&!le.cleanModel&&r(function(){ee(ne,0)})})},ce)}function K(){var t,r,n,o=[],i=0;e.order=[],e.groupPos={};for(r in e.groups)e.groups.hasOwnProperty(r)&&"$"!=r.charAt(0)&&o.push(r);for(N&&o.sort(),t=0;t<o.length;t++)r=o[t],n=e.groups[r],e.order=e.order.concat(n),e.groupPos[r]=i,i+=n.length}function Z(t){t=t||{},e.oldQuery=null,e.backspaceFocus=!1,e.groups={},e.order=[],e.showLoader=!1,e.isOpen=!1,ce=0,t.query||(e.query=""),v&&r.cancel(v)}function ee(t,r){e.selectorPosition=r,s.scrollActiveOption(t[0],t.find("li")[r])}function te(e){for(var t,r,n={"":[]},o=0;o<e.length;o++)t=j(e[o]),(r=n[t])||(r=n[t]=[]),r.push(e[o]);return n}p.$isEmpty=function(e){return!z(e)};var re=o.find("input"),ne=angular.element(o[0].querySelector(".select-dropdown")),oe=B(e),ie=Q(e),ae=V(e.$parent)||{},le=angular.extend({cleanModel:"prompt"===ae.newItem},u.options,ae),se=le.editItem,ue="correct"===se,ce=0;se!==!0&&"correct"!==se||(se="oiSelectEditItem");var pe=se?i.get(se):angular.noop,de=n(le.removeItemFn);f=le.searchFilter.split(":");var me=a(f[0]),fe=n(f[1]);f=le.dropdownFilter.split(":");var ge=a(f[0]),he=n(f[1]);f=le.listFilter.split(":");var ve=a(f[0]),we=n(f[1]);f=le.groupFilter.split(":");var ye=a(f[0]),$e=n(f[1]);P=le.newItemFn?n(le.newItemFn):function(e,t){return(V(t)||{}).newItemModel||t.$query},!le.cleanModel||se&&!ue||o.addClass("cleanMode");var be=s.bindFocusBlur(o,re);angular.isDefined(c.autofocus)&&r(function(){re[0].focus()}),angular.isDefined(c.readonly)&&re.attr("readonly",!0),angular.isDefined(c.tabindex)&&(re.attr("tabindex",c.tabindex),o[0].removeAttribute("tabindex")),le.maxlength&&re.attr("maxlength",le.maxlength),c.$observe("disabled",function(t){re.prop("disabled",t),$&&p.$modelValue&&p.$modelValue.length&&(e.inputHide=t)}),e.$on("$destroy",be),e.$parent.$watch(c.multipleLimit,function(e){b=Number(e)||1/0}),e.$parent.$watch(c.multiple,function(e){$=void 0===e?angular.isDefined(c.multiple):e,o[$?"addClass":"removeClass"]("multiple")}),e.$parent.$watch(c.ngModel,function(r,n){var o=X(r),i=t.when(o);F(),z(n)&&r!==n&&d(),$||C(),A&&z(r)&&(i=J(null,r).then(function(e){return s.intersection(o,e,null,_)}),v=null),$&&c.disabled&&!z(r)&&(e.inputHide=!1),i.then(function(t){e.output=t,t.length!==o.length&&e.removeItem(t.length)})}),e.$watch("query",function(t,r){k(t.slice(0,-1),t.slice(-1))||(t===r||e.oldQuery&&!t||h||(ne[0].scrollTop=0,t?(J(t),e.oldQuery=null):$&&(Z(),h=!0)),h=!1)}),e.$watch("groups",function(t){s.groupsIsEmpty(t)?e.isOpen=!1:e.isOpen||c.disabled||(e.isOpen=!0,e.isFocused=!0)}),e.$watch("isFocused",function(e){l[e?"addClass":"removeClass"](o,"focused",!N&&{tempClasses:"focused-animate"})}),e.$watch("isOpen",function(e){l[e?"addClass":"removeClass"](o,"open",!N&&{tempClasses:"open-animate"})}),e.$watch("showLoader",function(e){l[e?"addClass":"removeClass"](o,"loading",!N&&{tempClasses:"loading-animate"})}),e.addItem=function(t){if(w=e.query,!$||!s.intersection(e.output,[t],E,E).length){if(e.output.length>=b)return void m("limited");var r=e.groups[j(t)]=e.groups[j(t)]||[],n=A?_(t):t;r.splice(r.indexOf(t),1),$?p.$setViewValue(angular.isArray(p.$modelValue)?p.$modelValue.concat(n):[n]):(p.$setViewValue(n),C()),s.groupsIsEmpty(e.groups)&&(e.groups={}),$||le.closeList||Z({query:!0}),d(),e.oldQuery=e.oldQuery||e.query,e.query="",e.backspaceFocus=!1}},e.removeItem=function(r){c.disabled||$&&0>r||(y=$?p.$modelValue[r]:p.$modelValue,t.when(de(e.$parent,{$item:y})).then(function(){($||e.inputHide)&&($?(p.$modelValue.splice(r,1),p.$setViewValue([].concat(p.$modelValue))):(I(),le.cleanModel&&p.$setViewValue(void 0)),!$&&e.backspaceFocus||(e.query=pe(y,w,G,ue,o)||""),$&&le.closeList&&Z({query:!0}))}))},e.setSelection=function(t){g||e.selectorPosition===t?g=!1:ee(ne,t)},e.keyUp=function(t){switch(t.keyCode){case 8:e.query.length||$&&e.output.length||Z()}},e.keyDown=function(t){var r=0,n=e.order.length-1;switch(t.keyCode){case 38:e.selectorPosition=angular.isNumber(e.selectorPosition)?e.selectorPosition:r,ee(ne,e.selectorPosition===r?n:e.selectorPosition-1),g=!0;break;case 40:e.selectorPosition=angular.isNumber(e.selectorPosition)?e.selectorPosition:r-1,ee(ne,e.selectorPosition===n?r:e.selectorPosition+1),g=!0,e.query.length||e.isOpen||J(),e.inputHide&&I();break;case 37:case 39:break;case 9:k("tab");break;case 13:k("enter"),t.preventDefault();break;case 32:k("space");break;case 27:$||(C(),le.cleanModel&&p.$setViewValue(y)),Z();break;case 8:if(!e.query.length){if($&&!se||(e.backspaceFocus=!0),e.backspaceFocus&&e.output&&(!$||e.output.length)){e.removeItem(e.output.length-1),se&&t.preventDefault();break}e.backspaceFocus=!e.backspaceFocus;break}default:return e.inputHide&&I(),e.backspaceFocus=!1,!1}},e.getSearchLabel=function(t){var r=G(t);return me(r,e.oldQuery||e.query,t,fe(e.$parent),o)},e.getDropdownLabel=function(t){var r=G(t);return ge(r,e.oldQuery||e.query,t,he(e.$parent),o)},e.getGroupLabel=function(t,r){return ye(t,e.oldQuery||e.query,r,$e(e.$parent),o)},e.getDisableWhen=W,Z(),o[0].addEventListener("click",x,!0),o.on("focus",U),o.on("blur",T)}}}}]),angular.module("oi.select").filter("oiSelectGroup",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("oiSelectCloseIcon",["$sce",function(e){return function(t){var r='<span class="close select-search-list-item_selection-remove">×</span>';return e.trustAsHtml(t+r)}}]).filter("oiSelectHighlight",["$sce","oiSelectEscape",function(e,t){return function(r,n){var o;return n.length>0||angular.isNumber(n)?(r=r.toString(),n=t(n.toString()),o=r.replace(new RegExp(n,"gi"),"<strong>$&</strong>")):o=r,e.trustAsHtml(o)}}]).filter("oiSelectAscSort",["oiSelectEscape",function(e){function t(t,r,n,o){var i,a,l,s,u=[],c=[],p=[],d=[];if(r){for(r=e(String(r)),i=0,l=!1;i<t.length;i++){if(l=n(t[i]).match(new RegExp(r,"i")),!l&&o&&(o.length||o.fields))for(a=0;a<o.length&&!l;a++)l=String(t[i][o[a]]).match(new RegExp(r,"i"));l&&u.push(t[i])}for(i=0;i<u.length;i++)n(u[i]).match(new RegExp("^"+r,"i"))?c.push(u[i]):p.push(u[i]);if(s=c.concat(p),o&&(o===!0||o.all)){e:for(i=0;i<t.length;i++){for(a=0;a<s.length;a++)if(t[i]===s[a])continue e;d.push(t[i])}s=s.concat(d)}}else s=[].concat(t);return s}return t}]).filter("none",function(){return function(e){return e}}),angular.module("oi.select").run(["$templateCache",function(e){e.put("src/template.html",'<div class=select-search><ul class=select-search-list><li class="btn btn-default btn-xs select-search-list-item select-search-list-item_selection" ng-hide=listItemHide ng-repeat="item in output track by $index" ng-class="{focused: backspaceFocus && $last}" ng-click=removeItem($index) ng-bind-html=getSearchLabel(item)></li><li class="select-search-list-item select-search-list-item_input" ng-class="{\'select-search-list-item_hide\': inputHide}"><input autocomplete=off ng-model=query ng-keyup=keyUp($event) ng-keydown=keyDown($event)></li><li class="select-search-list-item select-search-list-item_loader" ng-show=showLoader></li></ul></div><div class=select-dropdown ng-show=isOpen><ul ng-if=isOpen class=select-dropdown-optgroup ng-repeat="(group, options) in groups"><div class=select-dropdown-optgroup-header ng-if="group && options.length" ng-bind-html="getGroupLabel(group, options)"></div><li class=select-dropdown-optgroup-option ng-init="isDisabled = getDisableWhen(option)" ng-repeat="option in options" ng-class="{\'active\': selectorPosition === groupPos[group] + $index, \'disabled\': isDisabled, \'ungroup\': !group}" ng-click="isDisabled || addItem(option)" ng-mouseenter="setSelection(groupPos[group] + $index)" ng-bind-html=getDropdownLabel(option)></li></ul></div>');
}]),angular.module("dbonyx").controller("forumCtrl",["$scope","forumService",function(e,t){t.getCategories(function(t,r){t?e.error=t:e.categories=r})}]).controller("forumCatCtrl",["$sce","$scope","$routeParams","$route","forumService","onyxUser",function(e,t,r,n,o,i){t.categoryId=r.categoryId,t.user=i,o.getCategory(t.categoryId,function(e,r){e?t.error=e:(t.category=r,t.category.threads.forEach(function(e){e.lastMessage=new Date(e.posts[e.posts.length-1].createdOn).toLocaleString()}))}),t.newThread=function(){t.error=!1,o.newThread(t.categoryId,t.title,t.message,function(e,r){e&&(t.error=e),r&&n.reload()})},t.previewThread=function(){t.error=!1,o.previewPost(t.message,function(r,n){t.preview=e.trustAsHtml(n)})}}]).controller("forumThreadCtrl",["$sce","$scope","$routeParams","$route","forumService","onyxUser",function(e,t,r,n,o,i){t.threadId=r.threadId,t.user=i,o.getThread(t.threadId,function(r,n){r?t.error=r:(t.thread=n,t.thread.posts.forEach(function(t){t.compiled=e.trustAsHtml(t.parsedContent)}))}),t.postMessage=function(){t.error=!1,o.postMessage(t.threadId,t.message,function(e,r){e&&(t.error=e),r&&n.reload()})},t.editOn=function(e){var r=t.thread.posts[e];r.editText=r.message,r.editing=!0},t.editOff=function(e){t.thread.posts[e].editing=!1},t.submitEdit=function(e){var r=t.thread.posts[e];o.editPost(r._id,r.editText,function(e,t){r.editing=!1,n.reload()})},t.previewPost=function(r){r.preventDefault(),o.previewPost(t.message,function(r,n){t.preview=e.trustAsHtml(n)})},t.previewEdit=function(r){var n=t.thread.posts[r];o.previewPost(n.editText,function(t,r){n.preview=e.trustAsHtml(r)})}}]).controller("forumAdminCtrl",["$scope","$location","$route","onyxUser","forumService",function(e,t,r,n,o){n.getPrivateProfile(function(r,n){!r&&n&&1===n.userLevel||t.path("/forums"),e.user=n}),o.getCategories(function(t,r){t||!r?e.categories=!1:e.categories=r}),e.subCategory=[],e.topCategory={name:""},e.createTopCategory=function(){var t=e.topCategory.name;o.createTopCategory(t,function(t,n){return t?void(e.error=t):void r.reload()})},e.createSubCategory=function(t,n){var i=e.subCategory[n]||"";o.createSubCategory(i,t,function(t,n){return t?void(e.error=t):void r.reload()})}}]).controller("siteNewsCtrl",["$sce","$scope","forumService",function(e,t,r){r.getSiteNews(function(r,n){r||!n?t.error=r:(t.news=n,t.news.threads.forEach(function(t){t.replyCount=t.posts.length-1,t.postDate=new Date(t.posts[0].createdOn).toDateString(),t.compiled=e.trustAsHtml(t.posts[0].parsedContent)}))})}]).factory("forumService",["$http","Auth",function(e,t){var r={};return r.getCategories=function(t){e({url:"/api/forum/categories"}).then(function(e){t(null,e.data)},function(e){t(e.data.error)})},r.getCategory=function(t,r){e({url:"/api/forum/category/"+t}).then(function(e){r(null,e.data)},function(e){r(e.data.error)})},r.getThread=function(t,r){e({url:"/api/forum/thread/"+t}).then(function(e){r(null,e.data)},function(e){r(e.data.error)})},r.newThread=function(t,r,n,o){e({method:"POST",url:"/api/forum/category/"+t,data:{title:r,message:n}}).then(function(e){o(null,e.data)},function(e){o(e.data.error)})},r.postMessage=function(t,r,n){e({method:"POST",url:"/api/forum/thread/"+t,data:{message:r}}).then(function(e){n(null,e.data)},function(e){n(e.data.error)})},r.createTopCategory=function(t,r){e({method:"POST",url:"/api/forum/category/",data:{name:t}}).then(function(e){r(null,e.data)},function(e){r(e.data.error)})},r.createSubCategory=function(t,r,n){e({method:"POST",url:"/api/forum/subcategory/",data:{name:t,id:r}}).then(function(e){n(null,e.data)},function(e){n(e.data.error)})},r.getSiteNews=function(t){e({url:"/api/forum/sitenews/"}).then(function(e){t(null,e.data)},function(e){t(e.data.error)})},r.editPost=function(t,r,n){e({url:"/api/forum/post/"+t,method:"POST",data:{text:r}}).then(function(e){n(null,e.data)},function(e){console.log(e.data.error),n(e.data.error)})},r.previewPost=function(t,r){console.log(t),e({url:"/api/forum/preview",method:"POST",data:{message:t}}).then(function(e){r(null,e.data.preview)},function(e){r(e.data.error)})},r}]),angular.module("dbonyx").controller("parserCtrl",["$scope","$http","$compile",function(e,t,r){e.parse=function(){angular.element(document.getElementById("errorDiv")).html(""),angular.element(document.getElementById("testDiv")).html("Parsing..."),t({url:"/api/forum/preview",method:"POST",data:{message:e.parsetext}}).then(function(t){var n=r("<div>"+t.data.preview+"</div>")(e);e.parsedtext=t.data.preview,angular.element(document.getElementById("testDiv")).html("").append(n)},function(t){e.parsedtext=t.data,angular.element(document.getElementById("errorDiv")).html("").append(t.data)})}}]),angular.module("dbonyx").controller("guildCtrl",["onyxGuild","$scope","$routeParams",function(e,t,r){t.guildName=r.name,t.guildServer=r.server,e.getGuild(t.guildName,t.guildServer,"us",function(e,r){return e||!r?void(t.error=e):void(t.guild=r)})}]),angular.module("dbonyx").factory("onyxGuild",["$http",function(e){var t={};return t.getGuild=function(t,r,n,o){var i={name:t,realm:r,region:n};e({method:"GET",url:"/api/guild/",params:i}).then(function(e){o(!1,e.data)},function(e){o(e.error)})},t}]),angular.module("ItemCtrls",[]).factory("itemService",["$http",function(e){var t={};return t.getItem=function(r,n,o){var i=parseInt(r);return t.id===i?void o(t):void e({method:"GET",url:"/api/item/pretty/"+i,params:{modifiers:n||{}}}).then(function(e){var t=e.data.item;o(t)},function(e){o(!1)})},t.prettify=function(e){},t}]).factory("itemAuctionService",["$http",function(e){var t={};return t.getItemAuctionDetails=function(t,r,n){e({method:"GET",url:"/api/auction/item/",params:{realm:r,id:t}}).then(function(e){n(!0)},function(e){n(!1)})},t}]).controller("itemCtrl",["$scope","$routeParams","itemService","itemAuctionService",function(e,t,r,n){e.id=t.id,e.auctionData=null,e.realmInput="",e.modifiers={},t.rand&&(e.modifiers.rand=parseInt(t.rand)),e.getItem=function(){e.item="Loading",e.loading=!0,r.getItem(e.id,e.modifiers,function(t){e.item=t,e.loading=!1})},e.getAuctionDetails=function(){e.auctionLoading=!0,n.getItemAuctionDetails(e.id,e.realmInput,function(e){})},e.getItem()}]).directive("itemDisplay",function(){var e=["$scope","itemService",function(e,t){e.getItem=function(){e.item="Loading",e.loading=!0,t.getItem(e.itemId,e.modifiers,function(t){e.item=t,e.loading=!1})},e.getItem()}];return{controller:e,restrict:"E",replace:!0,scope:{itemId:"@",modifiers:"="},templateUrl:"app/templates/itemDisplay.html"}}).directive("itemLink",[function(){var e=["$scope","itemService",function(e,t){function r(){e.itemLinkPath="/item/"+e.item.itemId;var t=[];"0"!==e.rand&&void 0!==e.rand&&t.push("rand="+e.rand),t.length&&(e.itemLinkPath+="?",t.forEach(function(r,n){e.itemLinkPath+=r,n<t.length-1&&(e.itemLinkPath+="&")})),e.quantity&&1!==parseInt(e.quantity)&&(e.showQuantity=!0)}e.itemid&&t.getItem(e.itemid,{},function(t){t&&(e.item=t,r())}),e.item||(e.item={name:"Unknown Item",itemId:0,_id:0}),r()}];return{controller:e,scope:{item:"=",itemid:"=",quantity:"@",rand:"@"},replace:!0,templateUrl:"app/templates/itemLink.html"}}]).directive("itemHover",["$compile","$window",function(e,t){return{restrict:"A",link:function(r,n,o){var i;n.bind("mouseover",function(n){var o={left:n.clientX+t.scrollX+5+"px",top:n.clientY+t.scrollY+"px"};if(r.el)angular.element(document.body).append(r.el),r.el.css(o);else{var a=r.item||r.$parent.item,l=a.id||a._id||a.itemId;i&&i.remove(),r.el=angular.element("<div class='itemHover'>"),i=r.el.append(e("<item-display item-id='"+l+"' modifiers='item'>")(r)),angular.element(document.body).append(i),i.css(o)}}),n.bind("mouseleave",function(){a()}),n.on("$destroy",function(){a()});var a=function(){i&&i.remove()}}}}]),angular.module("dbonyx").directive("sidebar",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"app/templates/sidebar.html"}}]).directive("mainContent",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"app/templates/mainContent.html"}}]).directive("onyxFooter",[function(){return{templateUrl:"app/templates/footer.html"}}]).directive("selectOnFocus",["$window",function(e){return{restrict:"A",link:function(t,r,n){r.on("focus",function(){e.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}]).directive("autoComplete",[function(){var e=["onyxPersistence","$scope","realmService",function(e,t,r){t.realmInputSelected=!1,t.realms=r.realms,t.blurIn=function(e){0==t.realms.length&&t.getRealms(),t[e]=!0},t.blurOut=function(e){t[e]=!1},t.getRealms=function(){r.getRealms(function(){t.realms=r.realms})},t.selectRealm=function(r){t.realmInput=r,e.setRealm(r),setTimeout(t.search,0)},t.hover=function(e){t.hoverIndex=e}}];return{restrict:"E",replace:!0,scope:{realmInput:"=",search:"&"},templateUrl:"app/templates/autoComplete.html",controller:e}}]).directive("money",function(){var e=["$scope",function(e){e.amount=parseInt(e.amount),e.copper=e.amount%100,e.silver=parseInt(e.amount/100)%100,e.gold=parseInt(e.amount/1e4)}];return{restrict:"E",replace:!0,scope:{amount:"="},templateUrl:"app/templates/money.html",controller:e}}).directive("onyxPagination",[function(){var e=["$scope","$timeout",function(e,t){e.updatePages=function(t){e.paginate.offset>e.paginate.count&&(e.paginate.offset=Math.floor(e.paginate.count/e.paginate.limit)*e.paginate.limit),e.backPages=[],e.nextPages=[],e.total=e.paginate.count,e.resultPages=Math.ceil(e.total/e.paginate.limit),e.currentPage=Math.floor(e.paginate.offset/e.paginate.limit)+1,e.low=e.paginate.offset,e.high=Math.min(e.paginate.offset+e.paginate.limit,e.total);for(var r=e.currentPage-5;r<e.currentPage;r++)r>0&&e.backPages.push(r);for(var r=e.currentPage+1;r<=e.currentPage+5;r++)r<=e.resultPages&&e.nextPages.push(r);t&&e.update()},e.setPage=function(t){e.paginate.offset=(t-1)*e.paginate.limit,e.updatePages(!0)},e.firstPage=function(){e.paginate.offset=0,e.updatePages(!0)},e.nextPage=function(){e.paginate.offset+=e.paginate.limit,e.paginate.offset>e.paginate.count&&(e.paginate.offset=Math.floor(e.paginate.count/e.paginate.limit)*e.paginate.limit),e.updatePages(!0)},e.backPage=function(){e.paginate.offset-=e.paginate.limit,e.paginate.offset<0&&(e.paginate.offset=0),e.updatePages(!0)},e.lastPage=function(){e.paginate.offset=Math.floor(e.paginate.count/e.paginate.limit)*e.paginate.limit,e.updatePages(!0)},e.updatePages(!0)}];return{restrict:"E",controller:e,scope:{paginate:"=",term:"@",update:"&"},link:function(e){e.$on("paginateUpdate",function(){e.updatePages(!1)})},templateUrl:"app/templates/pagination.html"}}]),angular.module("dbonyx").factory("realmService",["$http",function(e){var t={};return t.realms=[],t.getRealms=function(r){if(t.realms.length){if(r)return r()}else t.realms=["Loading Realms"],e({method:"GET",url:"/api/realms"}).then(function(e){t.realms=e.data,r&&r()},function(e){t.realms=["Unable to Load Realms"],r&&r()})},t}]),angular.module("MenuCtrls",[]).controller("MenuCtrl",["$scope",function(e){}]).directive("menuBar",[function(){var e=["$scope",function(e){var t;e.rehover=function(){e.hover=!0},e.menus=[],this.off=e.off=function(){e.hover=!1,t=setTimeout(function(){e.hover||(e.menuSelected=!1,e.$apply())},500)},this.addMenu=function(t){e.menus.push(t)}}];return{restrict:"E",transclude:!0,scope:{},controller:e,templateUrl:"app/templates/menuBar.html"}}]).directive("menu",[function(){return{require:"^^menuBar",restrict:"E",transclude:!0,scope:{title:"@",link:"@",icon:"@"},link:function(e,t,r,n){n.addMenu(e)},templateUrl:"app/templates/menu.html"}}]),angular.module("dbonyx").controller("privateProfileCtrl",["$scope","onyxUser",function(e,t){e.user=t,e.loading=!0,t.getPrivateProfile(function(t,r){e.loading=!1,e.profileData=r,e.error=t})}]).controller("publicProfileCtrl",["$scope","$routeParams","onyxUser",function(e,t,r){e.user=r,e.loading=!0,r.getPublicProfile(t.username,function(t,r){e.loading=!1,e.profileData=r,e.error=t})}]),angular.module("dbonyx").controller("questCtrl",["$scope","$routeParams","questService",function(e,t,r){e.questId=t.questId,e.loading=r.loading,e.error=r.error,e.quest=r.quest;var n=function(){r.getQuest(e.questId,function(){e.quest=r.quest,e.error=r.error})};n()}]).controller("allQuestsCtrl",["$scope","allQuestService",function(e,t){e.settings=t.settings,e.loading=t.loading,e.error=t.error,e.quests=t.allQuests,e.getQuests=function(){t.getQuests(function(){e.quests=t.allQuests,e.error=t.error,e.settings=t.settings,e.$broadcast("paginateUpdate")})},e.getQuests()}]).factory("questService",["$http",function(e){var t={};return t.loading=!1,t.error=null,t.quest=null,t.getQuest=function(r,n){t.loading=!0,t.error=null,t.quest=null,r=parseInt(r),e({url:"/api/quest/"+r}).then(function(e){t.loading=!1,t.quest=e.data,n()},function(e){t.loading=!1,t.error=e.data.error,n()})},t}]).factory("allQuestService",["$http",function(e){var t={};return t.loading=!1,t.error=null,t.allQuests=null,t.settings={limit:50,offset:0,count:0},t.getQuests=function(r){t.loading=!0,t.error=null,t.allQuests=null,e({url:"/api/quest",params:{limit:t.settings.limit,offset:t.settings.offset}}).then(function(e){t.loading=!1,t.allQuests=e.data.quests,t.settings.count=e.data.count,r&&r()},function(e){t.error=e.data.error,t.loading=!1,r&&r()})},t}]);