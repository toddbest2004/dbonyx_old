var app=angular.module("dbonyx",["AuctionCtrls","ItemCtrls","MenuCtrls","UserCtrls","ngRoute","ngCookies","ngAnimate"]);app.config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,n){n.interceptors.push("AuthInterceptor"),e.when("/",{templateUrl:"app/views/index.html"}).when("/about",{templateUrl:"app/views/about.html"}).when("/auctions",{templateUrl:"app/views/auctions.html"}).when("/auctions/:realm",{templateUrl:"app/views/auctions.html"}).when("/database",{templateUrl:"app/views/database.html"}).when("/character",{templateUrl:"app/views/character/lookup.html"}).when("/c/:name/:server/",{templateUrl:"app/views/character/profile.html"}).when("/c/:name/:server/reputation",{templateUrl:"app/views/character/reputation.html"}).when("/c/:name/:server/achievements",{controller:"characterAchievementCtrl",templateUrl:"app/views/character/achievements.html"}).when("/c/:name/:server/mounts",{templateUrl:"app/views/character/mounts.html"}).when("/c/:name/:server/battlepets",{templateUrl:"app/views/character/battlepets.html"}).when("/c/:name/:server/professions",{templateUrl:"app/views/character/professions.html"}).when("/c/:name/:server/pvp",{templateUrl:"app/views/character/pvp.html"}).when("/g/:name/:server",{controller:"guildCtrl",templateUrl:"app/views/guild/profile.html"}).when("/community",{templateUrl:"app/views/community.html"}).when("/feedback",{templateUrl:"app/views/feedback.html"}).when("/item/:id",{templateUrl:"app/views/item.html"}).when("/mount/:id",{templateUrl:"app/views/mount.html"}).when("/privacy",{templateUrl:"app/views/privacy.html"}).when("/profile",{controller:"privateProfileCtrl",templateUrl:"app/views/privateprofile.html"}).when("/profile/:username",{controller:"publicProfileCtrl",templateUrl:"app/views/publicprofile.html"}).when("/quests",{controller:"allQuestsCtrl",templateUrl:"app/views/quests.html"}).when("/quests/:questId",{controller:"questCtrl",templateUrl:"app/views/quest.html"}).when("/register",{templateUrl:"app/views/register.html"}).when("/terms",{templateUrl:"app/views/terms.html"}).when("/validate/:user/:validateString",{templateUrl:"app/views/validate.html"}).when("/forums",{controller:"forumCtrl",templateUrl:"app/views/forums/forumMain.html"}).when("/forums/cat/:categoryId",{controller:"forumCatCtrl",templateUrl:"app/views/forums/forumCategory.html"}).when("/forums/thread/:threadId",{controller:"forumThreadCtrl",templateUrl:"app/views/forums/forumThread.html"}).when("/forums/admin",{controller:"forumAdminCtrl",templateUrl:"app/views/forums/forumAdmin.html"}).when("/battlepets",{controller:"allpetsCtrl",templateUrl:"app/views/battlepets/allpets.html"}).when("/battlepet",{controller:"allpetsCtrl",templateUrl:"app/views/battlepets/allpets.html"}).when("/battlepet/:id",{controller:"battlepetCtrl",templateUrl:"app/views/battlepets/battlepet.html"}).when("/parsertest",{controller:"parserCtrl",templateUrl:"app/views/parsertest.html"}).otherwise({templateUrl:"app/views/404.html"}),t.html5Mode(!0)}]).factory("onyxPersistence",["$cookies",function(e){var t,n={},r={};return n.setRealm=function(n){t=n,e.put("realm",n)},n.getRealm=function(){return t||e.get("realm")||""},n.set=function(t,n){r[t]=n,e.put(t,n)},n.get=function(t){return r[t]||e.get(t)||""},n}]).controller("mountCtrl",["$scope","$routeParams","$http",function(e,t,n){e.mountId=parseInt(t.id),e.mount={},e.loading=!0,e.mountId&&n({method:"GET",url:"/api/mount/"+e.mountId}).then(function(t){e.mount=t.data.mount},function(e){})}]).controller("feedbackCtrl",["$http","$scope",function(e,t){t.showForm=!0,t.sendFeedback=function(){t.error="",t.message&&t.title?e({url:"/api/user/feedback",method:"POST",data:{title:t.title,message:t.message}}).then(function(e){t.success="Your message has been sent successfully!",t.showForm=!1},function(e){t.error="There was an error sending your message, please try again."}):t.error="Please provide a title and a message."}}]).controller("watchlistCtrl",["$scope","$http",function(e,t){var n=function(){t({method:"GET",url:"/api/watchlist/"}).then(function(t){e.watchlists=t.data.watchlists},function(e){})};n(),e.watchlists=[]}]),angular.module("dbonyx").controller("searchBarCtrl",["$scope","searchBar",function(e,t){e.search=function(){t.search(e.searchTerm,function(t,n){return t?void(e.results=[]):void(e.results=n)})},e.clear=function(){e.searchTerm="",e.results=[]},e.hide=function(){setTimeout(function(){e.results=[],e.$apply()},100)},e.clear()}]).factory("searchBar",["$http",function(e){var t={};return t.results={},t.search=function(t,n){if(t.length<3)return n(!1,[]);var r={url:"/api/item/search/"+t};e(r).then(function(e){n(!1,e.data)},function(e){n(e.data.error)})},t}]),angular.module("UserCtrls",[]).factory("onyxUser",["$http","Auth",function(e,t){var n={loggedin:!1};return n.checkLoggedInStatus=function(){n.loggedin=t.isLoggedIn(),n.loggedin&&e({method:"POST",url:"/api/user/getUser"}).then(function(e){n.username=e.data.username,n.loggedin=!0},function(e){})},n.validateUser=function(t,n,r){e({method:"POST",url:"/api/user/validate",data:{username:t,validateString:n}}).then(function(e){return e},function(e){return r("There was an error validating your email.")})},n.login=function(r,o,a){e({method:"POST",url:"/api/user/login",data:{email:r,password:o}}).then(function(e){t.saveToken(e.data.token),n.username=e.data.username,n.email=e.data.email,n.loggedin=!0,a(null,!0)},function(e){a(e.data.error,!1)})},n.logout=function(){t.removeToken(),n.loggedin=!1,n.username=null,n.email=null},n.register=function(t,r,o,a,i){e({method:"POST",url:"/api/user/register",data:{username:t,email:r,password1:o,password2:a}}).then(function(e){n.login(r,o,function(e,t){i(!0)})},function(e){return i(null,e.data.error)})},n.getPublicProfile=function(t,n){e({url:"/api/user/publicProfile",params:{username:t}}).then(function(e){return n(null,e.data)},function(e){return n(e.data.error)})},n.getPrivateProfile=function(t){e({url:"/api/user/privateProfile"}).then(function(e){return t(null,e.data)},function(e){return t(e.data.error)})},n.checkLoggedInStatus(),n}]).factory("Auth",["$window",function(e){return{saveToken:function(t){e.localStorage["onyx-token"]=t},getToken:function(){return e.localStorage["onyx-token"]},removeToken:function(){return e.localStorage.removeItem("onyx-token")},isLoggedIn:function(){var e=this.getToken();return!!e}}}]).factory("AuthInterceptor",["Auth",function(e){return{request:function(t){var n=e.getToken();return n&&(t.headers.Authorization="JWT "+n),t}}}]).controller("validateCtrl",["$http","$location","$scope","$routeParams","onyxUser",function(e,t,n,r,o){o.validateUser(r.user,r.validateString,function(e){n.error=e})}]).controller("userCtrl",["onyxUser","$scope","$http","$location","$window",function(e,t,n,r,o){t.user=e,t.showRegisterForm=!1,t.showUserPanel=!1,t.showRegisterForm=!1,t.toggleRegister=function(){t.showRegisterForm=!t.showRegisterForm,t.signin=!1},t.login=function(){t.signin=!1,e.login(t.login.email,t.login.password,function(e,n){t.login.email=null,t.login.password=null,e&&(t.error=e),t.showRegisterForm=!1})},t.logout=function(){e.logout(),t.user=e,t.showUserPanel=!1},t.toggleUserPanel=function(){t.showUserPanel=!t.showUserPanel},t.signinActive=function(){t.signin=!0,t.showRegisterForm=!1,t.narrow=o.innerWidth<750,document.getElementById("email").focus()},t.register=function(){e.register(t.username,t.email,t.password1,t.password2,function(e,n){e?(t.success="Registered Successfully!",t.toggleRegister()):n&&(t.registerError=n)})},t.clearError=function(){t.error=!1,t.registerError=!1,t.success=!1}}]).directive("userRegisterForm",[function(){return{restrict:"E",replace:!0,templateUrl:"app/templates/userRegisterForm.html"}}]).directive("userPanel",[function(){return{restrict:"E",replace:!0,templateUrl:"app/templates/userPanel.html"}}]),angular.module("dbonyx").factory("achievementService",["$http",function(e){var t={};return t.achievements=[],t.getAchievements=function(n){e({method:"GET",url:"/api/achievements/achievements"}).then(function(e){t.achievements=e.data,n&&n(null,t.achievements)},function(e){n&&n(e.error)})},t.getCategories=function(n){e({method:"GET",url:"/api/achievements/categories"}).then(function(e){t.categories=e.data,n&&n(null,t.categories)},function(e){n&&n(e.error)})},t}]),angular.module("AuctionCtrls",[]).controller("AuctionCtrl",["$scope","$http","$location","$routeParams","$window","onyxPersistence","auctionService","realmService",function(e,t,n,r,o,a,i,l){var s=n.search();e.auctionService=i,e.searchTerm=s.s||"",e.realmInput=r.realm||"",e.validFilters=[{name:"Item Level",type:"Number"},{name:"Required Level",type:"Number"},{name:"Is Equippable",type:"Boolean"}],e.itemQualities=["Poor","Common","Uncommon","Rare","Epic","Legendary","Artifact","Heirloom"],e.selectedQuality="",e.auctionResults=i.auctionResults,e.loading=!1,e.filters=i.filters,e.newfilter={},e.validComparators=null,e.qualities={values:[]},e.auctionSettings=i.settings;var u=function(e){for(var t,n,r=e.length;r>0;)n=Math.floor(Math.random()*r),t=e[n],e[n]=e[r-1],e[r-1]=t,r--;return e};l.getRealms(function(){e.realms=l.realms,e.randomRealms=u(e.realms.slice())}),e.setSortBy=function(t){i.setSortBy(t),e.search()},e.updateFilter=function(){"Number"===e.validFilters[e.newfilter.type].type?(e.validComparators=[">","=","<"],e.showFilterValue=!0):"Boolean"===e.validFilters[e.newfilter.type].type&&(e.validComparators=["True","False"],e.showFilterValue=!1)},e.addFilter=function(){var t=e.validFilters[e.newfilter.type].name,n=e.newfilter.comparator,r=e.newfilter.value;i.filters.push({type:t,comparator:n,value:r}),e.newfilter={},e.showFilterValue=!1,e.validComparators=null,e.search()},e.removeFilter=function(t){i.filters.splice(t,1),e.search()};var c=function(t){e.loading=!1,e.auctionResults=i.auctionResults,e.$broadcast("paginateUpdate")};e.search=function(t){t&&t.preventDefault(),e.loading=!0,i.qualities=e.qualities.values.map(function(e,t){return e?t.toString():null}).filter(function(e){return e}),i.filters=e.filters,i.setSearchTerm(e.searchTerm),i.setRealm(e.realmInput),i.search(c)},e.loadRealm=function(){e.realmInput&&(o.location.href="/auctions/"+e.realmInput)},e.realmInput&&e.search()}]),angular.module("AuctionCtrls").directive("auctionResult",function(){var e=["$scope",function(e){e.toggleHistory=function(){e.showAuctionHistory=!e.showAuctionHistory}}];return{restrict:"E",replace:!0,controller:e,templateUrl:"app/templates/auctionResult.html"}}).directive("watchlistForm",function(){var e=["$scope","$http","onyxUser",function(e,t,n){e.user=n,e.minQuantity=1,e.item?e.maxQuantity=e.item.stackable||9999:e.maxQuantity=9999,e.price||(e.price=0),e.originalPrice=e.price,e.gold=Math.floor(e.price/1e4),e.silver=Math.floor(e.price%1e4/100),e.copper=e.price%100,e.submit=function(){var n=parseInt(e.copper+100*e.silver+1e4*e.gold);t({method:"POST",url:"/api/watchlist",data:{price:n,item:e.item._id,min:e.minQuantity,max:e.maxQuantity,realm:e.realmInput}}).then(function(e){},function(e){})}}];return{restrict:"E",controller:e,scope:{item:"=",price:"@",showWatchlist:"=",realmInput:"="},templateUrl:"app/templates/watchlist.html"}}).directive("auctionHistory",function(){var e=["$scope","auctionHistory",function(e,t){e.item&&t.search(e.item._id,e.realmInput,function(t,n){if(e.aucHistoryLoading=!1,t||!n)return t;e.histories=n.histories,e.count=e.histories.length,e.barwidth=Math.floor(480/e.count),e.barheight=280,e.width=e.barwidth*e.count;for(var r=0;r<e.histories.length;r++){var o=parseInt(e.histories[r].sellingPrice/e.histories[r].sold);e.histories[r].x=e.barwidth*r,e.histories[r].y=e.barheight-(e.barheight-25)*o/n.max,e.histories[r].averagePrice=o,e.histories[r].soldy=e.barheight+(40-40*(e.histories[r].sold/n.maxQuantity)),e.histories[r].soldheight=40*(e.histories[r].sold/n.maxQuantity),e.histories[r].expiredheight=40*(e.histories[r].expired/n.maxQuantity),e.histories[r].expiredy=e.histories[r].soldy-e.histories[r].expiredheight}}),e.aucHistoryLoading=!0,e.hoverIn=function(t){e.histories[t].selected=!0,e.selected=e.histories[t]},e.hoverOut=function(t){e.histories[t].selected=!1,e.selected=!1}}];return{restrict:"E",controller:e,scope:{item:"=",showAuctionHistory:"&",realmInput:"="},templateUrl:"app/templates/auctionHistory.html"}}),angular.module("AuctionCtrls").factory("auctionService",["$http",function(e){var t={searchTerm:"",realmInput:"",filters:[],qualities:[],sortBy:"buyout",sortOrder:-1,loading:!1,settings:{limit:25,offset:0},auctionResults:!1};return t.setSearchTerm=function(e){t.searchTerm=e},t.setRealm=function(e){t.realmInput=e},t.noMatch=function(){t.loading=!1,t.auctionResults=[],t.settings.count=0},t.search=function(n){return t.realmInput.length?void e({method:"GET",url:"/api/auction/fetchauctions",params:{"qualities[]":t.qualities,"filters[]":t.filters,searchTerm:t.searchTerm,realm:t.realmInput,offset:t.settings.offset,limit:t.settings.limit,sortBy:t.sortBy,sortOrder:t.sortOrder}}).then(function(e){t.loading=!1,t.auctionResults=e.data,t.settings.count=e.data.count,n(!0)},function(e){t.noMatch(),n(!1)}):(t.noMatch(),void n(!1))},t.setSortBy=function(e){t.sortBy===e?t.sortOrder*=-1:(t.sortBy=e,t.sortOrder=-1)},t}]).factory("auctionHistory",["$http",function(e){var t={};return t.search=function(t,n,r){e({method:"GET",url:"/api/auction/auctionHistory",params:{item:t,realm:n}}).then(function(e){r(null,e.data)},function(e){r(e.data,null)})},t}]),angular.module("dbonyx").controller("battlepetCtrl",["$scope","$routeParams","$location","battlepetService",function(e,t,n,r){e.id=t.id,e.petFamilies=r.petFamilies;var o=n.search();e.applyChanges=function(){e.pet.breedId||(e.pet.breedId=parseInt(o.b)||3),e.pet.level||(e.pet.level=parseInt(o.l)||1),e.pet.quality||(e.pet.quality=parseInt(o.q)||e.pet.qualityId||0)},e.computeStats=function(){e.pet.computed||(e.pet.computed={});var t=1+e.pet.quality/10,n=r.breeds[e.pet.breedId]||r.breeds[0],o=e.pet.level;e.pet.computed.health=Math.round(100+(e.pet.stats.health+10*n.h)*o*t),e.pet.computed.power=Math.round((e.pet.stats.power+2*n.p)*o*t),e.pet.computed.speed=Math.round((e.pet.stats.speed+2*n.s)*o*t)},e.getPet=function(){e.loading=!0,r.getOne(e.id,{},function(t,n){return e.loading=!1,t?e.error=t:(e.pet=n,e.applyChanges(),void e.computeStats())})},e.getPet()}]).controller("allpetsCtrl",["$scope","$location","battlepetService",function(e,t,n){var r=t.search();e.settings=n.settings,e.petFamilies=n.petFamilies,e.settings.offset=parseInt(r.o)||e.settings.offset||0,e.settings.limit=parseInt(r.l)||e.settings.limit||25,e.filters={families:[]},e.loading=!0,e.search=function(){n.filters=e.filters,n.getAll(e.offset,e.limit,function(t,n){return e.$broadcast("paginateUpdate"),e.loading=!1,t?e.error=t:void(e.pets=n)})},e.search()}]).factory("battlepetService",["$http",function(e){var t={};return t.settings={limit:25,offset:0,count:0},t.petFamilies=["Humanoid","Dragonkin","Flying","Undead","Critter","Magical","Elemental","Beast","Aquatic","Mechanical"],t.breeds={0:{h:0,p:0,s:0,n:"Unknown Breed"},3:{h:.25,p:.25,s:.25,n:"B/B"},4:{h:0,p:1,s:0,n:"P/P"},5:{h:0,p:0,s:1,n:"S/S"},6:{h:1,p:0,s:0,n:"H/H"},7:{h:.45,p:.45,s:0,n:"H/P"},8:{h:0,p:.45,s:.45,n:"P/S"},9:{h:.45,p:0,s:.45,n:"H/S"},10:{h:.2,p:.45,s:.2,n:"P/B"},11:{h:.2,p:.2,s:.45,n:"S/B"},12:{h:.45,p:.2,s:.2,n:"H/B"}},t.filters={},t.getAll=function(n,r,o){e({method:"GET",url:"/api/battlepet/",params:{offset:t.settings.offset,limit:t.settings.limit,filters:t.filters}}).then(function(e){t.settings.count=e.data.count,o(null,e.data.pets)},function(e){t.settings.count=e.data.count,o(e.error)})},t.getOne=function(t,n,r){t=parseInt(t),n=n||{},e({url:"/api/battlepet/"+t,params:{modifiers:n}}).then(function(e){r(null,e.data)},function(e){r(e.error)})},t}]),angular.module("dbonyx").controller("characterCtrl",["onyxPersistence","onyxCharacter","$scope","$http","$location",function(e,t,n,r,o){n.character=t,n.search=function(e){n.error=!1,e&&e.preventDefault();var t=n.characterName,r=n.realmInput;return t&&r?void n.character.search(t,r,function(e){if(e){var t=e.name,r=e.realm,a=e.region;o.url("/c/"+t+"/"+r+"-"+a+"/")}else n.error="Unable to find character."}):void(n.error="Missing one or more required fields.")},n.selectCharacter=function(e){var r=n.results[e].name,a=n.results[e].realm,i=n.results[e].region.toUpperCase();t.setCharacter(n.results[e]),o.url("/c/"+r+"/"+a+"-"+i+"/")}}]).controller("characterMain",["onyxCharacter","$routeParams","$scope",function(e,t,n){var r=t.name,o=t.server;e.name&&e.name==t.name||e.search(r,o,function(e){e&&(n.character=e,console.log("loaded"))}),n.character=e}]).controller("characterAchievementCtrl",["onyxCharacter","achievementService","$routeParams","$scope",function(e,t,n,r){var o=n.name,a=n.server;e.name&&e.name==n.name||e.search(o,a,function(e){e&&(r.character=e,console.log("loaded"))}),t.getAchievements(function(e,t){e||(r.achievements=t)}),t.getCategories(function(e,t){e||(r.categories=t)}),r.character=e}]).controller("characterProfessions",["onyxCharacter","$routeParams","$scope",function(e,t,n){var r=t.name,o=t.server;e.name&&e.name==t.name||e.search(r,o,function(e){e&&(n.character=e,console.log("loaded"))}),n.character=e,n.expandRecipes=[!1,!1,!1,!1,!1,!1],n.expandToggle=function(e){n.expandRecipes[e]=!n.expandRecipes[e]}}]),angular.module("dbonyx").directive("characterLinks",[function(){var e=["$scope",function(e){e.links=[{title:"Profile",suffix:""},{title:"Reputation",suffix:"reputation"},{title:"Achievements",suffix:"achievements"},{title:"Mounts",suffix:"mounts"},{title:"Battlepets",suffix:"battlepets"},{title:"Professions",suffix:"professions"},{title:"Pvp",suffix:"pvp"}]}];return{controller:e,restrict:"E",replace:!0,templateUrl:"app/templates/characterLinks.html"}}]),angular.module("dbonyx").factory("onyxCharacter",["$http",function(e){var t={},n=[],r={items:!0,mounts:!0,achievements:!0,reputation:!0,professions:!0,battlepets:!0};return t.loaded=!1,t.setCharacter=function(e){for(var n in e)t[n]=e[n]},t.runOnLoad=function(){for(var e=0;e<n.length;e++)t.get(n[e])},t.search=function(n,r,o){if(t.loading=!0,!n)return t.loading=!1,void o(!1);var a={name:n};r&&(a.realm=r),e({method:"GET",url:"/api/character/search",params:a}).then(function(e){1===e.data.count?(t.setCharacter(e.data.character),t.loading=!1,t.loaded=!0,t.runOnLoad(),o(t),console.log(t)):(t.loading=!1,o(e.data.characters))},function(e){t.loading=!1,o(!1)})},t.get=function(o){if(r[o]){if(!t.loaded)return void n.push(o);if(t.name&&t.realm&&t.region){var a={name:t.name,realm:t.realm,region:t.region};e({method:"GET",url:"/api/character/"+o,params:a}).then(function(e){console.log(o),t[o]=e.data[o],"professions"===o&&console.log(e.data)},function(e){console.log(e)})}}},t}]),angular.module("dbonyx").controller("importCtrl",["$scope","fileUpload",function(e,t){e.setFile=function(t){e.selectedFile=t},e.importData=function(){e.selectedFile&&(console.log("importing"),t.uploadFileToUrl(e.selectedFile[0]))}}]).service("fileUpload",["$http","Auth",function(e,t){this.uploadFileToUrl=function(t){var n=new FormData;n.append("importFile",t),e.post("/api/data/import",n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){}).error(function(){})}}]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,n,r){var o=e(r.fileModel),a=o.assign;n.bind("change",function(){t.$apply(function(){a(t,n[0].files[0])})})}}}]),angular.module("oi.select",[]),angular.module("oi.select").provider("oiSelect",function(){return{options:{debounce:500,searchFilter:"oiSelectCloseIcon",dropdownFilter:"oiSelectHighlight",listFilter:"oiSelectAscSort",groupFilter:"oiSelectGroup",editItem:!1,newItem:!1,closeList:!0,saveTrigger:"enter tab blur"},version:{full:"0.2.20",major:0,minor:2,dot:20},$get:function(){return{options:this.options,version:this.version}}}}).factory("oiSelectEscape",function(){var e=/[-\/\\^$*+?.()|[\]{}]/g,t="\\$&";return function(n){return String(n).replace(e,t)}}).factory("oiSelectEditItem",function(){return function(e,t,n,r){return r?"":n(e)}}).factory("oiUtils",["$document","$timeout",function(e,t){function n(e,t,n){for(var r=t;r&&r.ownerDocument&&11!==r.nodeType;){if(n){if(r===e)return!1;if(r.className.indexOf(n)>=0)return!0}else if(r===e)return!0;r=r.parentNode}return!1}function r(r,o){function a(e){return e&&"INPUT"!==e.target.nodeName?void 0:(p=!1,c?void(p=!0):void t(function(){r.triggerHandler("blur")}))}function i(){u||(u=!0,t(function(){r.triggerHandler("focus")}))}function l(){c=!0}function s(e){c=!1;var i=e.target,l=n(r[0],i);p&&!l&&a(),l&&"INPUT"!==i.nodeName&&t(function(){o[0].focus()}),!l&&u&&(u=!1)}var u,c,p;return e[0].addEventListener("click",s,!0),r[0].addEventListener("mousedown",l,!0),r[0].addEventListener("blur",a,!0),o.on("focus",i),function(){e[0].removeEventListener("click",s),r[0].removeEventListener("mousedown",l,!0),r[0].removeEventListener("blur",a,!0),o.off("focus",i)}}function o(e,t){var n,r,o,a,l,u;t&&(r=e.offsetHeight,o=s(t,"height","margin"),a=e.scrollTop||0,n=i(t).top-i(e).top+a,l=n,u=n-r+o,n+o>r+a?e.scrollTop=u:a>n&&(e.scrollTop=l))}function a(e,t,n,r,o){function a(e){return parseFloat(o[e])}for(var i=n===(r?"border":"content")?4:"width"===t?1:0,l=0,s=["Top","Right","Bottom","Left"];4>i;i+=2)"margin"===n&&(l+=a(n+s[i])),r?("content"===n&&(l-=a("padding"+s[i])),"margin"!==n&&(l-=a("border"+s[i]+"Width"))):(l+=a("padding"+s[i]),"padding"!==n&&(l+=a("border"+s[i]+"Width")));return l}function i(e){var t,n,r=e.getBoundingClientRect(),o=e&&e.ownerDocument;if(o)return t=o.documentElement,n=l(o),{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}}function l(e){return null!=e&&e===e.window?e:9===e.nodeType&&e.defaultView}function s(e,t,n){var r=!0,o="width"===t?e.offsetWidth:e.offsetHeight,i=window.getComputedStyle(e,null),l=!1;if(0>=o||null==o){if(o=i[t],(0>o||null==o)&&(o=e.style[t]),f.test(o))return o;o=parseFloat(o)||0}return o+a(e,t,n||(l?"border":"content"),r,i)}function u(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t].length)return!1;return!0}function c(e){var t=[];return angular.forEach(e,function(e,n){"$"!==n.toString().charAt(0)&&t.push(e)}),t}function p(e,t,n,r,o){var a,i,l,s,u,c=o?[].concat(e):[];for(a=0,l=e.length;a<e.length;a++)for(s=n?n(e[a]):e[a],i=0;i<t.length;i++)if(u=r?r(t[i]):t[i],angular.equals(s,u,e,t,a,i)){o?c.splice(a+c.length-l,1):c.push(t[i]);break}return c}function m(e,t,n,r){var o={};return e.split(".").reduce(function(e,n,r,o){return e[n]=r<o.length-1?{}:t},o),r(n,o)}var d=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,f=new RegExp("^("+d+")(?!px)[a-z%]+$","i");return{contains:n,bindFocusBlur:r,scrollActiveOption:o,groupsIsEmpty:u,objToArr:c,getValue:m,intersection:p}}]),angular.module("oi.select").directive("oiSelect",["$document","$q","$timeout","$parse","$interpolate","$injector","$filter","$animate","oiUtils","oiSelect",function(e,t,n,r,o,a,i,l,s,u){var c=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,p=/([^\(\)\s\|\s]*)\s*(\(.*\))?\s*(\|?\s*.+)?/;return{restrict:"AE",templateUrl:"src/template.html",require:"ngModel",scope:{},compile:function(e,m){var d=m.oiOptions,f=d?d.match(c):["","i","","","","i","","",""];if(!f)throw new Error("Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_'");var g,h,v,w,y,$,b,P,I=/ as /.test(f[0])&&f[1],C=f[2]||f[1],S=f[5]||f[7],x=f[3]||"",U=f[4]||"",T=f[9]||C,k=f[8].match(p),q=k[1],E=q+(k[3]||""),F=q+(k[2]||""),A=I&&r(I),L=r(C),R=r(x),O=r(U),H=r(E),M=r(F),D=r(T),Q=o(m.multiplePlaceholder||""),B=o(m.placeholder||""),V=r(m.oiSelectOptions),G=angular.version.major<=1&&angular.version.minor<=3;return function(e,o,c,p){function m(){ue&&o.removeClass("cleanMode"),ue=!1}function d(e,t){t=t||150,o.addClass(e),n(function(){o.removeClass(e)},t)}function I(){e.listItemHide=!0,e.inputHide=!1}function C(){var t=z(p.$modelValue);e.listItemHide=!t,e.inputHide=t}function x(t){s.contains(o[0],t.target,"disabled")||e.output.length>=b&&s.contains(o[0],t.target,"select-dropdown")||(e.inputHide&&e.removeItem(0),!e.isOpen||!le.closeList||"INPUT"===t.target.nodeName&&e.query.length?J(e.query):(Z({query:le.editItem&&!ue}),e.$evalAsync()))}function U(t){e.isFocused||(e.isFocused=!0,c.disabled||(e.backspaceFocus=!1))}function T(t){e.isFocused=!1,$||C(),k("blur")||Z(),e.$evalAsync()}function k(r,o){o||(o=r,r=e.query);var a,i=le.saveTrigger.split(" ").indexOf(o)+1,l=le.newItem&&r,s="blur"!==o?e.order[e.selectorPosition]:null;return i&&(l||s)?(e.showLoader=!0,a=t.when(s||P(e.$parent,{$query:r})),a.then(function(r){if(void 0===r)return t.reject();e.addItem(r);var o=e.order.length-1;e.selectorPosition===o&&ee(re,0),le.newItemFn&&!s||n(angular.noop),Z()})["catch"](function(){d("invalid-item"),e.showLoader=!1}),!0):void 0}function E(){var e=$&&z(p.$modelValue)?ae:oe;ne.attr("placeholder",e)}function F(t){return s.getValue(S,t,e.$parent,D)}function N(t){return s.getValue(S,t,e.$parent,A)}function _(t){return s.getValue(S,t,e.$parent,L)}function W(t){return s.getValue(S,t,e.$parent,O)}function j(t){return s.getValue(S,t,e.$parent,R)||""}function Y(t){return s.getValue(q,t,e.$parent,H)}function X(e){return e=e instanceof Array?e:e?[e]:[],e.filter(function(e){return e&&(e instanceof Array&&e.length||A||_(e))})}function z(e){return!!X(e).length}function J(r,a){return v&&ce&&n.cancel(v),v=n(function(){var i=M(e.$parent,{$query:r,$selectedAs:a})||"";return e.selectorPosition="prompt"===le.newItem?!1:0,r||a||(e.oldQuery=null),(i.$promise&&!i.$resolved||angular.isFunction(i.then))&&(ce=le.debounce),e.showLoader=!0,t.when(i.$promise||i).then(function(t){if(e.groups={},t&&!a){var n=$?e.output:[],i=ve(s.objToArr(t),r,_,we(e.$parent),o),l=s.intersection(i,n,F,F,!0),u=Y(l);e.groups=te(u)}return K(),t})["finally"](function(){e.showLoader=!1,le.closeList&&!le.cleanModel&&n(function(){ee(re,0)})})},ce)}function K(){var t,n,r,o=[],a=0;e.order=[],e.groupPos={};for(n in e.groups)e.groups.hasOwnProperty(n)&&"$"!=n.charAt(0)&&o.push(n);for(G&&o.sort(),t=0;t<o.length;t++)n=o[t],r=e.groups[n],e.order=e.order.concat(r),e.groupPos[n]=a,a+=r.length}function Z(t){t=t||{},e.oldQuery=null,e.backspaceFocus=!1,e.groups={},e.order=[],e.showLoader=!1,e.isOpen=!1,ce=0,t.query||(e.query=""),v&&n.cancel(v)}function ee(t,n){e.selectorPosition=n,s.scrollActiveOption(t[0],t.find("li")[n])}function te(e){for(var t,n,r={"":[]},o=0;o<e.length;o++)t=j(e[o]),(n=r[t])||(n=r[t]=[]),n.push(e[o]);return r}p.$isEmpty=function(e){return!z(e)};var ne=o.find("input"),re=angular.element(o[0].querySelector(".select-dropdown")),oe=B(e),ae=Q(e),ie=V(e.$parent)||{},le=angular.extend({cleanModel:"prompt"===ie.newItem},u.options,ie),se=le.editItem,ue="correct"===se,ce=0;se!==!0&&"correct"!==se||(se="oiSelectEditItem");var pe=se?a.get(se):angular.noop,me=r(le.removeItemFn);f=le.searchFilter.split(":");var de=i(f[0]),fe=r(f[1]);f=le.dropdownFilter.split(":");var ge=i(f[0]),he=r(f[1]);f=le.listFilter.split(":");var ve=i(f[0]),we=r(f[1]);f=le.groupFilter.split(":");var ye=i(f[0]),$e=r(f[1]);P=le.newItemFn?r(le.newItemFn):function(e,t){return(V(t)||{}).newItemModel||t.$query},!le.cleanModel||se&&!ue||o.addClass("cleanMode");var be=s.bindFocusBlur(o,ne);angular.isDefined(c.autofocus)&&n(function(){ne[0].focus()}),angular.isDefined(c.readonly)&&ne.attr("readonly",!0),angular.isDefined(c.tabindex)&&(ne.attr("tabindex",c.tabindex),o[0].removeAttribute("tabindex")),le.maxlength&&ne.attr("maxlength",le.maxlength),c.$observe("disabled",function(t){ne.prop("disabled",t),$&&p.$modelValue&&p.$modelValue.length&&(e.inputHide=t)}),e.$on("$destroy",be),e.$parent.$watch(c.multipleLimit,function(e){b=Number(e)||1/0}),e.$parent.$watch(c.multiple,function(e){$=void 0===e?angular.isDefined(c.multiple):e,o[$?"addClass":"removeClass"]("multiple")}),e.$parent.$watch(c.ngModel,function(n,r){var o=X(n),a=t.when(o);E(),z(r)&&n!==r&&m(),$||C(),A&&z(n)&&(a=J(null,n).then(function(e){return s.intersection(o,e,null,N)}),v=null),$&&c.disabled&&!z(n)&&(e.inputHide=!1),a.then(function(t){e.output=t,t.length!==o.length&&e.removeItem(t.length)})}),e.$watch("query",function(t,n){k(t.slice(0,-1),t.slice(-1))||(t===n||e.oldQuery&&!t||h||(re[0].scrollTop=0,t?(J(t),e.oldQuery=null):$&&(Z(),h=!0)),h=!1)}),e.$watch("groups",function(t){s.groupsIsEmpty(t)?e.isOpen=!1:e.isOpen||c.disabled||(e.isOpen=!0,e.isFocused=!0)}),e.$watch("isFocused",function(e){l[e?"addClass":"removeClass"](o,"focused",!G&&{tempClasses:"focused-animate"})}),e.$watch("isOpen",function(e){l[e?"addClass":"removeClass"](o,"open",!G&&{tempClasses:"open-animate"})}),e.$watch("showLoader",function(e){l[e?"addClass":"removeClass"](o,"loading",!G&&{tempClasses:"loading-animate"})}),e.addItem=function(t){if(w=e.query,!$||!s.intersection(e.output,[t],F,F).length){if(e.output.length>=b)return void d("limited");var n=e.groups[j(t)]=e.groups[j(t)]||[],r=A?N(t):t;n.splice(n.indexOf(t),1),$?p.$setViewValue(angular.isArray(p.$modelValue)?p.$modelValue.concat(r):[r]):(p.$setViewValue(r),C()),s.groupsIsEmpty(e.groups)&&(e.groups={}),$||le.closeList||Z({query:!0}),m(),e.oldQuery=e.oldQuery||e.query,e.query="",e.backspaceFocus=!1}},e.removeItem=function(n){c.disabled||$&&0>n||(y=$?p.$modelValue[n]:p.$modelValue,t.when(me(e.$parent,{$item:y})).then(function(){($||e.inputHide)&&($?(p.$modelValue.splice(n,1),p.$setViewValue([].concat(p.$modelValue))):(I(),le.cleanModel&&p.$setViewValue(void 0)),!$&&e.backspaceFocus||(e.query=pe(y,w,_,ue,o)||""),$&&le.closeList&&Z({query:!0}))}))},e.setSelection=function(t){g||e.selectorPosition===t?g=!1:ee(re,t)},e.keyUp=function(t){switch(t.keyCode){case 8:e.query.length||$&&e.output.length||Z()}},e.keyDown=function(t){var n=0,r=e.order.length-1;switch(t.keyCode){case 38:e.selectorPosition=angular.isNumber(e.selectorPosition)?e.selectorPosition:n,ee(re,e.selectorPosition===n?r:e.selectorPosition-1),g=!0;break;case 40:e.selectorPosition=angular.isNumber(e.selectorPosition)?e.selectorPosition:n-1,ee(re,e.selectorPosition===r?n:e.selectorPosition+1),g=!0,e.query.length||e.isOpen||J(),e.inputHide&&I();break;case 37:case 39:break;case 9:k("tab");break;case 13:k("enter"),t.preventDefault();break;case 32:k("space");break;case 27:$||(C(),le.cleanModel&&p.$setViewValue(y)),Z();break;case 8:if(!e.query.length){if($&&!se||(e.backspaceFocus=!0),e.backspaceFocus&&e.output&&(!$||e.output.length)){e.removeItem(e.output.length-1),se&&t.preventDefault();break}e.backspaceFocus=!e.backspaceFocus;break}default:return e.inputHide&&I(),e.backspaceFocus=!1,!1}},e.getSearchLabel=function(t){var n=_(t);return de(n,e.oldQuery||e.query,t,fe(e.$parent),o)},e.getDropdownLabel=function(t){var n=_(t);return ge(n,e.oldQuery||e.query,t,he(e.$parent),o)},e.getGroupLabel=function(t,n){return ye(t,e.oldQuery||e.query,n,$e(e.$parent),o)},e.getDisableWhen=W,Z(),o[0].addEventListener("click",x,!0),o.on("focus",U),o.on("blur",T)}}}}]),angular.module("oi.select").filter("oiSelectGroup",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("oiSelectCloseIcon",["$sce",function(e){return function(t){var n='<span class="close select-search-list-item_selection-remove">Ã—</span>';return e.trustAsHtml(t+n)}}]).filter("oiSelectHighlight",["$sce","oiSelectEscape",function(e,t){return function(n,r){var o;return r.length>0||angular.isNumber(r)?(n=n.toString(),r=t(r.toString()),o=n.replace(new RegExp(r,"gi"),"<strong>$&</strong>")):o=n,e.trustAsHtml(o)}}]).filter("oiSelectAscSort",["oiSelectEscape",function(e){function t(t,n,r,o){var a,i,l,s,u=[],c=[],p=[],m=[];if(n){for(n=e(String(n)),a=0,l=!1;a<t.length;a++){if(l=r(t[a]).match(new RegExp(n,"i")),!l&&o&&(o.length||o.fields))for(i=0;i<o.length&&!l;i++)l=String(t[a][o[i]]).match(new RegExp(n,"i"));l&&u.push(t[a])}for(a=0;a<u.length;a++)r(u[a]).match(new RegExp("^"+n,"i"))?c.push(u[a]):p.push(u[a]);if(s=c.concat(p),o&&(o===!0||o.all)){e:for(a=0;a<t.length;a++){for(i=0;i<s.length;i++)if(t[a]===s[i])continue e;
m.push(t[a])}s=s.concat(m)}}else s=[].concat(t);return s}return t}]).filter("none",function(){return function(e){return e}}),angular.module("oi.select").run(["$templateCache",function(e){e.put("src/template.html",'<div class=select-search><ul class=select-search-list><li class="btn btn-default btn-xs select-search-list-item select-search-list-item_selection" ng-hide=listItemHide ng-repeat="item in output track by $index" ng-class="{focused: backspaceFocus && $last}" ng-click=removeItem($index) ng-bind-html=getSearchLabel(item)></li><li class="select-search-list-item select-search-list-item_input" ng-class="{\'select-search-list-item_hide\': inputHide}"><input autocomplete=off ng-model=query ng-keyup=keyUp($event) ng-keydown=keyDown($event)></li><li class="select-search-list-item select-search-list-item_loader" ng-show=showLoader></li></ul></div><div class=select-dropdown ng-show=isOpen><ul ng-if=isOpen class=select-dropdown-optgroup ng-repeat="(group, options) in groups"><div class=select-dropdown-optgroup-header ng-if="group && options.length" ng-bind-html="getGroupLabel(group, options)"></div><li class=select-dropdown-optgroup-option ng-init="isDisabled = getDisableWhen(option)" ng-repeat="option in options" ng-class="{\'active\': selectorPosition === groupPos[group] + $index, \'disabled\': isDisabled, \'ungroup\': !group}" ng-click="isDisabled || addItem(option)" ng-mouseenter="setSelection(groupPos[group] + $index)" ng-bind-html=getDropdownLabel(option)></li></ul></div>')}]),angular.module("dbonyx").controller("forumCtrl",["$scope","forumService",function(e,t){t.getCategories(function(t,n){t?e.error=t:e.categories=n})}]).controller("forumCatCtrl",["$sce","$scope","$routeParams","$route","forumService","onyxUser",function(e,t,n,r,o,a){t.categoryId=n.categoryId,t.user=a,o.getCategory(t.categoryId,function(e,n){e?t.error=e:(t.category=n,t.category.threads.forEach(function(e){e.lastMessage=new Date(e.posts[e.posts.length-1].createdOn).toLocaleString()}))}),t.newThread=function(){t.error=!1,o.newThread(t.categoryId,t.title,t.message,function(e,n){e&&(t.error=e),n&&r.reload()})},t.previewThread=function(){t.error=!1,o.previewPost(t.message,function(n,r){t.preview=e.trustAsHtml(r)})}}]).controller("forumThreadCtrl",["$sce","$scope","$routeParams","$route","forumService","onyxUser",function(e,t,n,r,o,a){t.threadId=n.threadId,t.user=a,o.getThread(t.threadId,function(n,r){n?t.error=n:(t.thread=r,t.thread.posts.forEach(function(t){t.compiled=e.trustAsHtml(t.parsedContent)}))}),t.postMessage=function(){t.error=!1,o.postMessage(t.threadId,t.message,function(e,n){e&&(t.error=e),n&&r.reload()})},t.editOn=function(e){var n=t.thread.posts[e];n.editText=n.message,n.editing=!0},t.editOff=function(e){t.thread.posts[e].editing=!1},t.submitEdit=function(e){var n=t.thread.posts[e];o.editPost(n._id,n.editText,function(e,t){n.editing=!1,r.reload()})},t.previewPost=function(n){n.preventDefault(),o.previewPost(t.message,function(n,r){t.preview=e.trustAsHtml(r)})},t.previewEdit=function(n){var r=t.thread.posts[n];o.previewPost(r.editText,function(t,n){r.preview=e.trustAsHtml(n)})}}]).controller("forumAdminCtrl",["$scope","$location","$route","onyxUser","forumService",function(e,t,n,r,o){r.getPrivateProfile(function(n,r){!n&&r&&1===r.userLevel||t.path("/forums"),e.user=r}),o.getCategories(function(t,n){t||!n?e.categories=!1:e.categories=n}),e.subCategory=[],e.topCategory={name:""},e.createTopCategory=function(){var t=e.topCategory.name;o.createTopCategory(t,function(t,r){return t?void(e.error=t):void n.reload()})},e.createSubCategory=function(t,r){var a=e.subCategory[r]||"";o.createSubCategory(a,t,function(t,r){return t?void(e.error=t):void n.reload()})}}]).controller("siteNewsCtrl",["$sce","$scope","forumService",function(e,t,n){n.getSiteNews(function(n,r){n||!r?t.error=n:(t.news=r,t.news.threads.forEach(function(t){t.replyCount=t.posts.length-1,t.postDate=new Date(t.posts[0].createdOn).toDateString(),t.compiled=e.trustAsHtml(t.posts[0].parsedContent)}))})}]).factory("forumService",["$http","Auth",function(e,t){var n={};return n.getCategories=function(t){e({url:"/api/forum/categories"}).then(function(e){t(null,e.data)},function(e){t(e.data.error)})},n.getCategory=function(t,n){e({url:"/api/forum/category/"+t}).then(function(e){n(null,e.data)},function(e){n(e.data.error)})},n.getThread=function(t,n){e({url:"/api/forum/thread/"+t}).then(function(e){n(null,e.data)},function(e){n(e.data.error)})},n.newThread=function(t,n,r,o){e({method:"POST",url:"/api/forum/category/"+t,data:{title:n,message:r}}).then(function(e){o(null,e.data)},function(e){o(e.data.error)})},n.postMessage=function(t,n,r){e({method:"POST",url:"/api/forum/thread/"+t,data:{message:n}}).then(function(e){r(null,e.data)},function(e){r(e.data.error)})},n.createTopCategory=function(t,n){e({method:"POST",url:"/api/forum/category/",data:{name:t}}).then(function(e){n(null,e.data)},function(e){n(e.data.error)})},n.createSubCategory=function(t,n,r){e({method:"POST",url:"/api/forum/subcategory/",data:{name:t,id:n}}).then(function(e){r(null,e.data)},function(e){r(e.data.error)})},n.getSiteNews=function(t){e({url:"/api/forum/sitenews/"}).then(function(e){t(null,e.data)},function(e){t(e.data.error)})},n.editPost=function(t,n,r){e({url:"/api/forum/post/"+t,method:"POST",data:{text:n}}).then(function(e){r(null,e.data)},function(e){console.log(e.data.error),r(e.data.error)})},n.previewPost=function(t,n){console.log(t),e({url:"/api/forum/preview",method:"POST",data:{message:t}}).then(function(e){n(null,e.data.preview)},function(e){n(e.data.error)})},n}]),angular.module("dbonyx").controller("parserCtrl",["$scope","$http","$compile",function(e,t,n){e.parse=function(){angular.element(document.getElementById("errorDiv")).html(""),angular.element(document.getElementById("testDiv")).html("Parsing..."),t({url:"/api/forum/preview",method:"POST",data:{message:e.parsetext}}).then(function(t){var r=n("<div>"+t.data.preview+"</div>")(e);e.parsedtext=t.data.preview,angular.element(document.getElementById("testDiv")).html("").append(r)},function(t){e.parsedtext=t.data,angular.element(document.getElementById("errorDiv")).html("").append(t.data)})}}]),angular.module("dbonyx").controller("guildCtrl",["onyxGuild","$scope","$routeParams",function(e,t,n){t.guildName=n.name,t.guildServer=n.server,t.characterClasses=["","Warrior","Paladin","Hunter","Rogue","Priest","Death Knight","Shaman","Mage","Warlock","Monk","Druid","Demon Hunter"],e.getGuild(t.guildName,t.guildServer,"us",function(e,n){return e||!n?void(t.error=e):void(t.guild=n)})}]),angular.module("dbonyx").factory("onyxGuild",["$http",function(e){var t={};return t.getGuild=function(t,n,r,o){var a={name:t,realm:n,region:r};e({method:"GET",url:"/api/guild/",params:a}).then(function(e){o(!1,e.data)},function(e){o(e.error)})},t}]),angular.module("ItemCtrls",[]).factory("itemService",["$http",function(e){var t={};return t.getItem=function(n,r,o){var a=parseInt(n);return t.id===a?void o(t):void e({method:"GET",url:"/api/item/pretty/"+a,params:{modifiers:r||{}}}).then(function(e){var t=e.data.item;o(t)},function(e){o(!1)})},t.prettify=function(e){},t}]).factory("itemAuctionService",["$http",function(e){var t={};return t.getItemAuctionDetails=function(t,n,r){e({method:"GET",url:"/api/auction/item/",params:{realm:n,id:t}}).then(function(e){r(!0)},function(e){r(!1)})},t}]).controller("itemCtrl",["$scope","$routeParams","itemService","itemAuctionService",function(e,t,n,r){e.id=t.id,e.auctionData=null,e.realmInput="",e.modifiers={},t.rand&&(e.modifiers.rand=parseInt(t.rand)),e.getItem=function(){e.item="Loading",e.loading=!0,n.getItem(e.id,e.modifiers,function(t){e.item=t,e.loading=!1})},e.getAuctionDetails=function(){e.auctionLoading=!0,r.getItemAuctionDetails(e.id,e.realmInput,function(e){})},e.getItem()}]).directive("itemDisplay",function(){var e=["$scope","itemService",function(e,t){e.getItem=function(){e.item="Loading",e.loading=!0,t.getItem(e.itemId,e.modifiers,function(t){e.item=t,e.loading=!1})},e.getItem()}];return{controller:e,restrict:"E",replace:!0,scope:{itemId:"@",modifiers:"="},templateUrl:"app/templates/itemDisplay.html"}}).directive("itemLink",[function(){var e=["$scope","itemService",function(e,t){function n(){e.itemLinkPath="/item/"+e.item.itemId;var t=[];"0"!==e.rand&&void 0!==e.rand&&t.push("rand="+e.rand),t.length&&(e.itemLinkPath+="?",t.forEach(function(n,r){e.itemLinkPath+=n,r<t.length-1&&(e.itemLinkPath+="&")})),e.quantity&&1!==parseInt(e.quantity)&&(e.showQuantity=!0)}e.itemid&&t.getItem(e.itemid,{},function(t){t&&(e.item=t,n())}),e.item||(e.item={name:"Unknown Item",itemId:0,_id:0}),n()}];return{controller:e,scope:{item:"=",itemid:"=",quantity:"@",rand:"@"},replace:!0,templateUrl:"app/templates/itemLink.html"}}]).directive("itemHover",["$compile","$window",function(e,t){return{restrict:"A",link:function(n,r,o){var a;r.bind("mouseover",function(r){var o={left:r.clientX+t.scrollX+5+"px",top:r.clientY+t.scrollY+"px"};if(n.el)angular.element(document.body).append(n.el),n.el.css(o);else{var i=n.item||n.$parent.item,l=i.id||i._id||i.itemId;a&&a.remove(),n.el=angular.element("<div class='itemHover'>"),a=n.el.append(e("<item-display item-id='"+l+"' modifiers='item'>")(n)),angular.element(document.body).append(a),a.css(o)}}),r.bind("mouseleave",function(){i()}),r.on("$destroy",function(){i()});var i=function(){a&&a.remove()}}}}]),angular.module("dbonyx").directive("sidebar",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"app/templates/sidebar.html"}}]).directive("mainContent",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"app/templates/mainContent.html"}}]).directive("onyxFooter",[function(){return{templateUrl:"app/templates/footer.html"}}]).directive("selectOnFocus",["$window",function(e){return{restrict:"A",link:function(t,n,r){n.on("focus",function(){e.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}]).directive("autoComplete",[function(){var e=["onyxPersistence","$scope","realmService",function(e,t,n){t.realmInputSelected=!1,t.realms=n.realms,t.blurIn=function(e){t.getRealms(),t[e]=!0},t.blurOut=function(e){t[e]=!1},t.getRealms=function(){n.getRealms(function(){t.realms=n.realms})},t.selectRealm=function(n){t.realmInput=n,e.setRealm(n),setTimeout(t.search,0)},t.hover=function(e){t.hoverIndex=e}}];return{restrict:"E",replace:!0,scope:{realmInput:"=",search:"&"},templateUrl:"app/templates/autoComplete.html",controller:e}}]).directive("money",function(){var e=["$scope",function(e){e.amount=parseInt(e.amount),e.copper=e.amount%100,e.silver=parseInt(e.amount/100)%100,e.gold=parseInt(e.amount/1e4)}];return{restrict:"E",replace:!0,scope:{amount:"="},templateUrl:"app/templates/money.html",controller:e}}).directive("onyxPagination",[function(){var e=["$scope","$timeout",function(e,t){e.updatePages=function(t){e.paginate.offset>e.paginate.count&&(e.paginate.offset=Math.floor(e.paginate.count/e.paginate.limit)*e.paginate.limit),e.backPages=[],e.nextPages=[],e.total=e.paginate.count,e.resultPages=Math.ceil(e.total/e.paginate.limit),e.currentPage=Math.floor(e.paginate.offset/e.paginate.limit)+1,e.low=e.paginate.offset,e.high=Math.min(e.paginate.offset+e.paginate.limit,e.total);for(var n=e.currentPage-5;n<e.currentPage;n++)n>0&&e.backPages.push(n);for(var n=e.currentPage+1;n<=e.currentPage+5;n++)n<=e.resultPages&&e.nextPages.push(n);t&&e.update()},e.setPage=function(t){e.paginate.offset=(t-1)*e.paginate.limit,e.updatePages(!0)},e.firstPage=function(){e.paginate.offset=0,e.updatePages(!0)},e.nextPage=function(){e.paginate.offset+=e.paginate.limit,e.paginate.offset>e.paginate.count&&(e.paginate.offset=Math.floor(e.paginate.count/e.paginate.limit)*e.paginate.limit),e.updatePages(!0)},e.backPage=function(){e.paginate.offset-=e.paginate.limit,e.paginate.offset<0&&(e.paginate.offset=0),e.updatePages(!0)},e.lastPage=function(){e.paginate.offset=Math.floor(e.paginate.count/e.paginate.limit)*e.paginate.limit,e.updatePages(!0)},e.updatePages(!0)}];return{restrict:"E",controller:e,scope:{paginate:"=",term:"@",update:"&"},link:function(e){e.$on("paginateUpdate",function(){e.updatePages(!1)})},templateUrl:"app/templates/pagination.html"}}]),angular.module("dbonyx").factory("realmService",["$http",function(e){var t={};return t.realms=[],t.getRealms=function(n){if(t.realms.length){if(n)return n()}else t.realms=["Loading Realms"],e({method:"GET",url:"/api/realms"}).then(function(e){t.realms=e.data,n&&n()},function(e){t.realms=["Unable to Load Realms"],n&&n()})},t}]),angular.module("MenuCtrls",[]).controller("MenuCtrl",["$scope",function(e){}]).directive("menuBar",[function(){var e=["$scope",function(e){var t;e.rehover=function(){e.hover=!0},e.menus=[],this.off=e.off=function(){e.hover=!1,t=setTimeout(function(){e.hover||(e.menuSelected=!1,e.$apply())},500)},this.addMenu=function(t){e.menus.push(t)}}];return{restrict:"E",transclude:!0,scope:{},controller:e,templateUrl:"app/templates/menuBar.html"}}]).directive("menu",[function(){return{require:"^^menuBar",restrict:"E",transclude:!0,scope:{title:"@",link:"@",icon:"@"},link:function(e,t,n,r){r.addMenu(e)},templateUrl:"app/templates/menu.html"}}]),angular.module("dbonyx").controller("privateProfileCtrl",["$scope","onyxUser",function(e,t){e.user=t,e.loading=!0,t.getPrivateProfile(function(t,n){e.loading=!1,e.userData=n.user,e.forumPosts=n.posts,e.error=t})}]).controller("publicProfileCtrl",["$scope","$routeParams","onyxUser",function(e,t,n){e.user=n,e.loading=!0,n.getPublicProfile(t.username,function(t,n){e.loading=!1,e.profileData=n,e.error=t})}]),angular.module("dbonyx").controller("questCtrl",["$scope","$routeParams","questService",function(e,t,n){e.questId=t.questId,e.loading=n.loading,e.error=n.error,e.quest=n.quest;var r=function(){n.getQuest(e.questId,function(){e.quest=n.quest,e.error=n.error})};r()}]).controller("allQuestsCtrl",["$scope","allQuestService",function(e,t){e.settings=t.settings,e.loading=t.loading,e.error=t.error,e.quests=t.allQuests,e.getQuests=function(){t.getQuests(function(){e.quests=t.allQuests,e.error=t.error,e.settings=t.settings,e.$broadcast("paginateUpdate")})},e.getQuests()}]).factory("questService",["$http",function(e){var t={};return t.loading=!1,t.error=null,t.quest=null,t.getQuest=function(n,r){t.loading=!0,t.error=null,t.quest=null,n=parseInt(n),e({url:"/api/quest/"+n}).then(function(e){t.loading=!1,t.quest=e.data,r()},function(e){t.loading=!1,t.error=e.data.error,r()})},t}]).factory("allQuestService",["$http",function(e){var t={};return t.loading=!1,t.error=null,t.allQuests=null,t.settings={limit:50,offset:0,count:0},t.getQuests=function(n){t.loading=!0,t.error=null,t.allQuests=null,e({url:"/api/quest",params:{limit:t.settings.limit,offset:t.settings.offset}}).then(function(e){t.loading=!1,t.allQuests=e.data.quests,t.settings.count=e.data.count,n&&n()},function(e){t.error=e.data.error,t.loading=!1,n&&n()})},t}]);